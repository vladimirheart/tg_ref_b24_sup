<!DOCTYPE html>
<html lang="ru" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Äî Support Panel</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <link rel="stylesheet" th:href="@{/css/sidebar.css}">
    <link rel="stylesheet" th:href="@{/css/app.css}">
    <style>
        .settings-tiles .settings-tile {
            border: 1px solid #e9ecef;
            border-radius: 1rem;
            background: linear-gradient(135deg, #f8f9fa, #ffffff);
            box-shadow: 0 0.125rem 0.5rem rgba(0, 0, 0, 0.08);
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .settings-tiles .settings-tile--accent {
            background: linear-gradient(135deg, rgba(13, 110, 253, 0.12), #ffffff);
            border-color: rgba(13, 110, 253, 0.2);
            box-shadow: 0 0.25rem 0.75rem rgba(13, 110, 253, 0.15);
        }

        .settings-tiles .settings-tile.is-active {
            border-color: rgba(13, 110, 253, 0.45);
            box-shadow: 0 0.75rem 1.5rem rgba(13, 110, 253, 0.2);
            background: linear-gradient(135deg, rgba(13, 110, 253, 0.18), #ffffff);
        }

        .settings-tiles .settings-tile:hover {
            transform: translateY(-4px);
            box-shadow: 0 0.75rem 1.5rem rgba(0, 0, 0, 0.12);
        }

        .settings-tiles .settings-tile .tile-icon {
            width: 3rem;
            height: 3rem;
            border-radius: 0.75rem;
            background: rgba(13, 110, 253, 0.08);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            margin-bottom: 1rem;
        }

        .settings-tiles .settings-tile--accent .tile-icon {
            background: rgba(13, 110, 253, 0.18);
            color: #0d6efd;
        }

        .settings-tiles .settings-tile .card-title {
            text-align: center;
            color: #0d6efd;
            font-weight: 600;
        }

        .settings-tiles .settings-tile--accent .card-text {
            color: #495057;
        }

        .modal-dialog {
            width: auto;
            max-width: min(90vw, var(--bs-modal-width, 500px));
            max-height: 90vh;
            margin-left: auto;
            margin-right: auto;
            overflow: auto;
            resize: both;
        }

        .modal-dialog.modal-lg {
            --bs-modal-width: 1000px;
        }

        .modal-dialog.modal-xl {
            --bs-modal-width: 1440px;
        }

        .modal-content {
            min-height: 100%;
            max-height: 100%;
            display: flex;
            flex-direction: column;
        }

        .modal-body {
            overflow-y: auto;
        }

        .status-pill {
            display: inline-flex;
            align-items: center;
            gap: 0.4rem;
            padding: 0.35rem 0.75rem;
            border-radius: 999px;
            border: 1px solid rgba(0, 0, 0, 0.08);
            font-weight: 600;
        }

        .status-color-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            border: 1px solid rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body class="with-sidebar sidebar-pinned">
<div th:replace="~{fragments/navbar :: navbar('settings')}"></div>
<main class="main-content container-fluid">
    <div class="container mt-4">
        <h2>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º—ã</h2>

        <div class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 settings-tiles">
            <div class="col">
                <div class="card settings-tile h-100" role="button" data-bs-toggle="modal" data-bs-target="#channelsModal">
                    <div class="card-body">
                        <div class="tile-icon">ü§ñ</div>
                        <h5 class="card-title">–ö–∞–Ω–∞–ª—ã (–±–æ—Ç—ã)</h5>
                        <p class="card-text text-muted">–ü–æ–¥–∫–ª—é—á–∞–π—Ç–µ –∏ —É–ø—Ä–∞–≤–ª—è–π—Ç–µ –±–æ—Ç–∞–º–∏ –≤ Telegram –∏ VK.</p>
                    </div>
                </div>
            </div>

            <div class="col">
                <div class="card settings-tile h-100" role="button" data-bs-toggle="modal" data-bs-target="#reportingModal">
                    <div class="card-body">
                        <div class="tile-icon">üìä</div>
                        <h5 class="card-title">–ê–≤—Ç–æ–æ—Ç—á—ë—Ç –ø–æ –æ–±—Ä–∞—â–µ–Ω–∏—è–º</h5>
                        <p class="card-text text-muted">–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–µ—Ä–∏–æ–¥ –∏ –≤—Ä–µ–º—è –æ—Ç–ø—Ä–∞–≤–∫–∏.</p>
                    </div>
                </div>
            </div>

            <div class="col">
                <div class="card settings-tile h-100" role="button" data-bs-toggle="modal" data-bs-target="#appearanceModal">
                    <div class="card-body">
                        <div class="tile-icon">üé®</div>
                        <h5 class="card-title">–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –ø–∞–Ω–µ–ª–∏</h5>
                        <p class="card-text text-muted">–í—ã–±–∏—Ä–∞–π—Ç–µ —Å–≤–µ—Ç–ª—É—é, —Ç—ë–º–Ω—É—é –∏–ª–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é —Ç–µ–º—É.</p>
                    </div>
                </div>
            </div>

            <div class="col">
                <div class="card settings-tile settings-tile--accent h-100" role="button" data-bs-toggle="modal" data-bs-target="#categoriesModal">
                    <div class="card-body">
                        <div class="tile-icon">üóÇÔ∏è</div>
                        <h5 class="card-title">–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–∏–∞–ª–æ–≥–æ–≤</h5>
                        <p class="card-text text-muted">–£–ø—Ä–∞–≤–ª—è–π—Ç–µ —à–∞–±–ª–æ–Ω–∞–º–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π, –≤–æ–ø—Ä–æ—Å–æ–≤ –∏ –¥–µ–π—Å—Ç–≤–∏–π.</p>
                    </div>
                </div>
            </div>

            <div class="col">
                <div class="card settings-tile settings-tile--accent h-100" role="button" data-bs-toggle="modal" data-bs-target="#parametersModal">
                    <div class="card-body">
                        <div class="tile-icon">üß©</div>
                        <h5 class="card-title">–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–∞—Ä—Ç–Ω—ë—Ä–æ–≤</h5>
                        <p class="card-text text-muted">–û–±–Ω–æ–≤–ª—è–π—Ç–µ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏ –∏ –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è —Ñ–æ—Ä–º.</p>
                    </div>
                </div>
            </div>

            <div class="col">
                <div class="card settings-tile settings-tile--accent h-100" role="button" data-bs-toggle="modal" data-bs-target="#itConnectionsModal">
                    <div class="card-body">
                        <div class="tile-icon">üñß</div>
                        <h5 class="card-title">–ü–æ–¥–∫–ª—é—á–µ–Ω–∏—è IT-–±–ª–æ–∫–∞</h5>
                        <p class="card-text text-muted">–£–ø—Ä–∞–≤–ª—è–π—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è–º–∏ –∏ –ø—Ä–æ—Ñ–∏–ª—è–º–∏ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤.</p>
                    </div>
                </div>
            </div>

            <div class="col">
                <div class="card settings-tile settings-tile--accent h-100" role="button" data-bs-toggle="modal" data-bs-target="#usersModal">
                    <div class="card-body">
                        <div class="tile-icon">üë•</div>
                        <h5 class="card-title">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–∞–Ω–µ–ª–∏ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–æ—Å—Ç—É–ø–∞</h5>
                        <p class="card-text text-muted">–°–æ–∑–¥–∞–≤–∞–π—Ç–µ —Ä–æ–ª–∏, –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–π—Ç–µ –ø—Ä–∞–≤–∞ –∏ —É–ø—Ä–∞–≤–ª—è–π—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏.</p>
                    </div>
                </div>
            </div>

            <div class="col">
                <div class="card settings-tile settings-tile--accent h-100" role="button" data-bs-toggle="modal" data-bs-target="#statusesModal">
                    <div class="card-body">
                        <div class="tile-icon">üè∑Ô∏è</div>
                        <h5 class="card-title">–°—Ç–∞—Ç—É—Å—ã –∫–ª–∏–µ–Ω—Ç–æ–≤</h5>
                        <p class="card-text text-muted">–°–æ–∑–¥–∞–≤–∞–π—Ç–µ —Å—Ç–∞—Ç—É—Å—ã –¥–ª—è —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤.</p>
                    </div>
                </div>
            </div>

            <div class="col">
                <div class="card settings-tile settings-tile--accent h-100" role="button" data-bs-toggle="modal" data-bs-target="#businessStylesModal">
                    <div class="card-body">
                        <div class="tile-icon">üè¢</div>
                        <h5 class="card-title">–ú–µ—Ç–∫–∏ –±–∏–∑–Ω–µ—Å–æ–≤</h5>
                        <p class="card-text text-muted">–ù–∞—Å—Ç—Ä–æ–π—Ç–µ —Ü–≤–µ—Ç–∞ –∏ –∏–∫–æ–Ω–∫–∏ —Å—Ç–æ–ª–±—Ü–∞ ¬´–ë–∏–∑–Ω–µ—Å¬ª.</p>
                    </div>
                </div>
            </div>

            <div class="col">
                <div class="card settings-tile settings-tile--accent h-100" role="button" data-bs-toggle="modal" data-bs-target="#locationsModal">
                    <div class="card-body">
                        <div class="tile-icon">üß≠</div>
                        <h5 class="card-title">–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ª–æ–∫–∞—Ü–∏–π</h5>
                        <p class="card-text text-muted">–£–ø—Ä–∞–≤–ª—è–π—Ç–µ –¥–µ—Ä–µ–≤–æ–º –±–∏–∑–Ω–µ—Å–æ–≤, —Ç–∏–ø–æ–≤ –∏ –ª–æ–∫–∞—Ü–∏–π.</p>
                    </div>
                </div>
            </div>

            <div class="col">
                <div class="card settings-tile settings-tile--accent h-100" role="button" data-bs-toggle="modal" data-bs-target="#legalEntitiesModal">
                    <div class="card-body">
                        <div class="tile-icon">üè¢</div>
                        <h5 class="card-title">–Æ—Ä–∏–¥–∏—á–µ—Å–∫–∏–µ –ª–∏—Ü–∞</h5>
                        <p class="card-text text-muted">–£–ø—Ä–∞–≤–ª—è–π—Ç–µ —Ä–µ–∫–≤–∏–∑–∏—Ç–∞–º–∏ –∏ –∫–æ–Ω—Ç–∞–∫—Ç–∞–º–∏ –ø–∞—Ä—Ç–Ω—ë—Ä–æ–≤.</p>
                    </div>
                </div>
            </div>

            <div class="col">
                <div class="card settings-tile settings-tile--accent h-100" role="button" data-bs-toggle="modal" data-bs-target="#inputFormattingModal">
                    <div class="card-body">
                        <div class="tile-icon"><i class="bi bi-input-cursor-text"></i></div>
                        <h5 class="card-title">–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤–≤–æ–¥–∏–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö</h5>
                        <p class="card-text text-muted">–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑—É–π—Ç–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –¥–ª—è —Ç–µ–ª–µ—Ñ–æ–Ω–æ–≤, e-mail –∏ –∞–¥—Ä–µ—Å–æ–≤.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="channelsModal" tabindex="-1" aria-labelledby="channelsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="channelsModalLabel">ü§ñ –ö–∞–Ω–∞–ª—ã (–±–æ—Ç—ã)</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="–ó–∞–∫—Ä—ã—Ç—å"></button>
                </div>
                <div class="modal-body">
                    <div class="table-responsive">
                        <table class="table align-middle">
                            <thead class="table-light">
                            <tr>
                                <th>–ö–∞–Ω–∞–ª</th>
                                <th>–ö–ª—é—á</th>
                                <th>–ó–Ω–∞—á–µ–Ω–∏–µ</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr th:if="${#lists.isEmpty(appSettings)}">
                                <td colspan="3" class="text-center text-muted py-4">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç</td>
                            </tr>
                            <tr th:each="setting : ${appSettings}">
                                <td th:text="${setting.channel != null ? setting.channel.channelName : '‚Äî'}"></td>
                                <td th:text="${setting.key}"></td>
                                <td><code th:text="${setting.value}"></code></td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="parametersModal" tabindex="-1" aria-labelledby="parametersModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="parametersModalLabel">üß© –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–∞—Ä—Ç–Ω—ë—Ä–æ–≤</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="–ó–∞–∫—Ä—ã—Ç—å"></button>
                </div>
                <div class="modal-body">
                    <div class="table-responsive">
                        <table class="table align-middle">
                            <thead class="table-light">
                            <tr>
                                <th>–¢–∏–ø</th>
                                <th>–ó–Ω–∞—á–µ–Ω–∏–µ</th>
                                <th>–°—Ç–∞—Ç—É—Å</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr th:if="${#lists.isEmpty(systemParameters)}">
                                <td colspan="3" class="text-center text-muted py-4">–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç</td>
                            </tr>
                            <tr th:each="systemParam : ${systemParameters}">
                                <td th:text="${systemParam.paramType}"></td>
                                <td><code th:text="${systemParam.value}"></code></td>
                                <td th:text="${systemParam.state} ?: '‚Äî'"></td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="statusesModal" tabindex="-1" aria-labelledby="statusesModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="statusesModalLabel">üè∑Ô∏è –°—Ç–∞—Ç—É—Å—ã –∫–ª–∏–µ–Ω—Ç–æ–≤</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="–ó–∞–∫—Ä—ã—Ç—å"></button>
                </div>
                <div class="modal-body">
                    <div class="d-flex flex-wrap align-items-center justify-content-between gap-2 mb-3">
                        <div>
                            <h6 class="mb-0">–°–ø–∏—Å–æ–∫ —Å—Ç–∞—Ç—É—Å–æ–≤</h6>
                            <span class="text-muted small">–ò–∑–º–µ–Ω–µ–Ω–∏—è –º–æ–∂–Ω–æ –≤–Ω–æ—Å–∏—Ç—å –≤ —Ä–µ–∂–∏–º–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.</span>
                        </div>
                        <div class="d-flex gap-2">
                            <button type="button" class="btn btn-outline-primary btn-sm" id="editStatusesBtn">
                                <i class="bi bi-pencil-square me-1"></i> –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                            </button>
                            <button type="button" class="btn btn-success btn-sm d-none" id="saveStatusesBtn">
                                <i class="bi bi-check-lg me-1"></i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                            </button>
                            <button type="button" class="btn btn-outline-secondary btn-sm d-none" id="cancelStatusesBtn">–û—Ç–º–µ–Ω–∞</button>
                        </div>
                    </div>
                    <div id="statusesList" class="list-group"></div>
                    <div id="statusesEmptyPlaceholder" class="text-muted fst-italic small d-none">
                        –ü–æ–∫–∞ –Ω–µ—Ç —Å—Ç–∞—Ç—É—Å–æ–≤. –ù–∞–∂–º–∏—Ç–µ ¬´–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å¬ª, —á—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–≤—ã–π —Å—Ç–∞—Ç—É—Å.
                    </div>
                    <button class="btn btn-sm btn-success mt-3 d-none" id="addStatusBtn" type="button">+ –î–æ–±–∞–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å</button>
                    <div class="alert alert-success mt-3 d-none" role="alert" id="statusesSuccess">–°—Ç–∞—Ç—É—Å—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã.</div>
                    <div class="alert alert-danger mt-3 d-none" role="alert" id="statusesError"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="reportingModal" tabindex="-1" aria-labelledby="reportingModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="reportingModalLabel">üìä –ê–≤—Ç–æ–æ—Ç—á—ë—Ç –ø–æ –æ–±—Ä–∞—â–µ–Ω–∏—è–º</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="–ó–∞–∫—Ä—ã—Ç—å"></button>
                </div>
                <div class="modal-body">
                    <div class="alert alert-light border">–†–∞–∑–¥–µ–ª –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ –∏ –±—É–¥–µ—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω —Å –ø–æ–ª–Ω–æ–π –≤–µ—Ä—Å–∏–µ–π –ø–∞–Ω–µ–ª–∏.</div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="appearanceModal" tabindex="-1" aria-labelledby="appearanceModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="appearanceModalLabel">üé® –û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –ø–∞–Ω–µ–ª–∏</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="–ó–∞–∫—Ä—ã—Ç—å"></button>
                </div>
                <div class="modal-body">
                    <div class="alert alert-light border">–†–∞–∑–¥–µ–ª –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ –∏ –±—É–¥–µ—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω —Å –ø–æ–ª–Ω–æ–π –≤–µ—Ä—Å–∏–µ–π –ø–∞–Ω–µ–ª–∏.</div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="categoriesModal" tabindex="-1" aria-labelledby="categoriesModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="categoriesModalLabel">üóÇÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–∏–∞–ª–æ–≥–æ–≤</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="–ó–∞–∫—Ä—ã—Ç—å"></button>
                </div>
                <div class="modal-body">
                    <div class="alert alert-light border">–†–∞–∑–¥–µ–ª –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ –∏ –±—É–¥–µ—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω —Å –ø–æ–ª–Ω–æ–π –≤–µ—Ä—Å–∏–µ–π –ø–∞–Ω–µ–ª–∏.</div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="itConnectionsModal" tabindex="-1" aria-labelledby="itConnectionsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="itConnectionsModalLabel">üñß –ü–æ–¥–∫–ª—é—á–µ–Ω–∏—è IT-–±–ª–æ–∫–∞</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="–ó–∞–∫—Ä—ã—Ç—å"></button>
                </div>
                <div class="modal-body">
                    <div class="alert alert-light border">–†–∞–∑–¥–µ–ª –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ –∏ –±—É–¥–µ—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω —Å –ø–æ–ª–Ω–æ–π –≤–µ—Ä—Å–∏–µ–π –ø–∞–Ω–µ–ª–∏.</div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="usersModal" tabindex="-1" aria-labelledby="usersModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="usersModalLabel">üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–∞–Ω–µ–ª–∏</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="–ó–∞–∫—Ä—ã—Ç—å"></button>
                </div>
                <div class="modal-body">
                    <div class="alert alert-light border">–†–∞–∑–¥–µ–ª –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ –∏ –±—É–¥–µ—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω —Å –ø–æ–ª–Ω–æ–π –≤–µ—Ä—Å–∏–µ–π –ø–∞–Ω–µ–ª–∏.</div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="businessStylesModal" tabindex="-1" aria-labelledby="businessStylesModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="businessStylesModalLabel">üè¢ –ú–µ—Ç–∫–∏ –±–∏–∑–Ω–µ—Å–æ–≤</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="–ó–∞–∫—Ä—ã—Ç—å"></button>
                </div>
                <div class="modal-body">
                    <div class="alert alert-light border">–†–∞–∑–¥–µ–ª –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ –∏ –±—É–¥–µ—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω —Å –ø–æ–ª–Ω–æ–π –≤–µ—Ä—Å–∏–µ–π –ø–∞–Ω–µ–ª–∏.</div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="locationsModal" tabindex="-1" aria-labelledby="locationsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="locationsModalLabel">üß≠ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ª–æ–∫–∞—Ü–∏–π</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="–ó–∞–∫—Ä—ã—Ç—å"></button>
                </div>
                <div class="modal-body">
                    <div class="alert alert-light border">–†–∞–∑–¥–µ–ª –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ –∏ –±—É–¥–µ—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω —Å –ø–æ–ª–Ω–æ–π –≤–µ—Ä—Å–∏–µ–π –ø–∞–Ω–µ–ª–∏.</div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="legalEntitiesModal" tabindex="-1" aria-labelledby="legalEntitiesModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="legalEntitiesModalLabel">üè¢ –Æ—Ä–∏–¥–∏—á–µ—Å–∫–∏–µ –ª–∏—Ü–∞</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="–ó–∞–∫—Ä—ã—Ç—å"></button>
                </div>
                <div class="modal-body">
                    <div class="alert alert-light border">–†–∞–∑–¥–µ–ª –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ –∏ –±—É–¥–µ—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω —Å –ø–æ–ª–Ω–æ–π –≤–µ—Ä—Å–∏–µ–π –ø–∞–Ω–µ–ª–∏.</div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="inputFormattingModal" tabindex="-1" aria-labelledby="inputFormattingModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="inputFormattingModalLabel">üßæ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤–≤–æ–¥–∏–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="–ó–∞–∫—Ä—ã—Ç—å"></button>
                </div>
                <div class="modal-body">
                    <div class="alert alert-light border">–†–∞–∑–¥–µ–ª –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ –∏ –±—É–¥–µ—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω —Å –ø–æ–ª–Ω–æ–π –≤–µ—Ä—Å–∏–µ–π –ø–∞–Ω–µ–ª–∏.</div>
                </div>
            </div>
        </div>
    </div>
</main>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
<script th:inline="javascript">
    const INITIAL_CLIENT_STATUSES = /*[[${clientStatuses}]]*/ [];
    const INITIAL_CLIENT_STATUS_COLORS = /*[[${clientStatusColors}]]*/ {};
</script>
<script>
    const statusesList = document.getElementById('statusesList');
    const editStatusesBtn = document.getElementById('editStatusesBtn');
    const saveStatusesBtn = document.getElementById('saveStatusesBtn');
    const cancelStatusesBtn = document.getElementById('cancelStatusesBtn');
    const addStatusBtn = document.getElementById('addStatusBtn');
    const statusesEmpty = document.getElementById('statusesEmptyPlaceholder');
    const statusesSuccess = document.getElementById('statusesSuccess');
    const statusesError = document.getElementById('statusesError');

    let currentStatuses = Array.isArray(INITIAL_CLIENT_STATUSES) ? [...INITIAL_CLIENT_STATUSES] : [];
    let currentColors = INITIAL_CLIENT_STATUS_COLORS && typeof INITIAL_CLIENT_STATUS_COLORS === 'object'
        ? { ...INITIAL_CLIENT_STATUS_COLORS }
        : {};
    let editSnapshot = [];
    let isEditMode = false;

    function clearStatusAlerts() {
        statusesSuccess?.classList.add('d-none');
        if (statusesError) {
            statusesError.textContent = '';
            statusesError.classList.add('d-none');
        }
    }

    function updateStatusesEmptyState() {
        if (!statusesEmpty) return;
        const hasItems = currentStatuses.length > 0;
        statusesEmpty.classList.toggle('d-none', hasItems);
    }

    function createStatusItem(status, color, editable) {
        const item = document.createElement('div');
        item.className = 'list-group-item d-flex align-items-center justify-content-between flex-wrap gap-3';
        if (editable) {
            item.innerHTML = `
                <div class="d-flex flex-wrap align-items-center gap-2 flex-grow-1">
                    <input class="form-control form-control-sm flex-grow-1 status-name-input" value="${status}">
                    <input type="color" class="form-control form-control-color status-color-input" value="${color || '#0d6efd'}">
                </div>
                <button class="btn btn-sm btn-outline-danger" type="button">–£–¥–∞–ª–∏—Ç—å</button>
            `;
            item.querySelector('button')?.addEventListener('click', () => {
                item.remove();
                currentStatuses = collectStatusItems().map((entry) => entry.name);
                updateStatusesEmptyState();
            });
        } else {
            const safeColor = color || '#0d6efd';
            item.innerHTML = `
                <div class="status-pill" style="border-color:${safeColor};">
                    <span class="status-color-dot" style="background:${safeColor};"></span>
                    <span>${status}</span>
                </div>
            `;
        }
        return item;
    }

    function renderStatusesList(editable = false) {
        if (!statusesList) return;
        statusesList.innerHTML = '';
        currentStatuses.forEach((status) => {
            const color = currentColors[status] || '#0d6efd';
            statusesList.appendChild(createStatusItem(status, color, editable));
        });
        updateStatusesEmptyState();
    }

    function collectStatusItems() {
        if (!statusesList) return [];
        return Array.from(statusesList.querySelectorAll('.list-group-item'))
            .map((item) => {
                const nameInput = item.querySelector('.status-name-input');
                const colorInput = item.querySelector('.status-color-input');
                const name = (nameInput?.value || item.textContent || '').trim();
                const color = (colorInput?.value || '').trim();
                return { name, color };
            })
            .filter((entry) => entry.name.length > 0);
    }

    function setEditMode(enable, restoreSnapshot = false) {
        isEditMode = enable;
        editStatusesBtn?.classList.toggle('d-none', enable);
        saveStatusesBtn?.classList.toggle('d-none', !enable);
        cancelStatusesBtn?.classList.toggle('d-none', !enable);
        addStatusBtn?.classList.toggle('d-none', !enable);

        if (restoreSnapshot) {
            currentStatuses = editSnapshot.map((entry) => entry.name);
            currentColors = editSnapshot.reduce((acc, entry) => {
                acc[entry.name] = entry.color;
                return acc;
            }, {});
        }
        renderStatusesList(enable);
    }

    function addStatus() {
        if (!statusesList) return;
        const newItem = createStatusItem('', '#0d6efd', true);
        statusesList.appendChild(newItem);
        updateStatusesEmptyState();
    }

    async function saveClientStatuses() {
        clearStatusAlerts();
        const entries = collectStatusItems();
        const statuses = [];
        const colors = {};
        entries.forEach((entry) => {
            if (!statuses.includes(entry.name)) {
                statuses.push(entry.name);
            }
            if (entry.color) {
                colors[entry.name] = entry.color;
            }
        });
        try {
            const response = await fetch('/api/settings/client-statuses', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ client_statuses: statuses, client_status_colors: colors })
            });
            const payload = await response.json();
            if (!response.ok || !payload.ok) {
                throw new Error(payload.error || '–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å—ã');
            }
            currentStatuses = [...statuses];
            currentColors = { ...colors };
            editSnapshot = entries;
            setEditMode(false);
            statusesSuccess?.classList.remove('d-none');
        } catch (error) {
            if (statusesError) {
                statusesError.textContent = error?.message || '–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è';
                statusesError.classList.remove('d-none');
            }
        }
    }

    editStatusesBtn?.addEventListener('click', () => {
        clearStatusAlerts();
        editSnapshot = collectStatusItems();
        if (!editSnapshot.length) {
            editSnapshot = currentStatuses.map((status) => ({ name: status, color: currentColors[status] || '#0d6efd' }));
        }
        setEditMode(true);
    });

    cancelStatusesBtn?.addEventListener('click', () => {
        clearStatusAlerts();
        setEditMode(false, true);
    });

    addStatusBtn?.addEventListener('click', () => {
        clearStatusAlerts();
        addStatus();
    });

    saveStatusesBtn?.addEventListener('click', () => {
        saveClientStatuses();
    });

    renderStatusesList(false);
    updateStatusesEmptyState();
</script>
</body>
</html>
