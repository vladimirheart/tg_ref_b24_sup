# UI/UX аудит панели Iguana и внедрённые улучшения

Документ обновлён в формате **engineering roadmap**: не только «что улучшать», но и **что уже внедрено**, как мерить эффект и как безопасно раскатывать изменения.

## 1) Что уже внедрено в проекте (в рамках текущих правок)

### 1.1. Saved views в списке диалогов
В интерфейс «Диалоги» добавлены быстрые представления (вкладки) по паттерну Zendesk/Freshdesk:
- **Все**
- **Активные**
- **Новые**
- **Без ответственного**
- **Просроченные**

Технически:
- добавлены кнопки-представления в toolbar;
- добавлена клиентская логика фильтрации по view;
- для «Просроченные» применён рабочий порог: открытый диалог старше 24 часов.

### 1.2. SLA-индикатор в таблице диалогов
В таблицу «Диалоги» добавлен столбец **SLA** с live-бейджем:
- **До SLA Xч Yм** — зелёный статус, если до порога больше 4 часов;
- **Риск Xч Yм** — жёлтый статус, если до порога менее 4 часов;
- **Просрочен Xч Yм** — красный статус после превышения порога;
- **Закрыт** — нейтральный статус для закрытых обращений.

Технически:
- принята рабочая формула SLA для очереди: **24 часа от времени создания открытого обращения**;
- бейдж обновляется на клиенте без перезагрузки и учитывает авто-обновление списка.


### 1.3. Quick actions в строке диалога
В таблицу «Диалоги» добавлены быстрые действия без открытия карточки:
- **Назначить мне** — берёт обращение в работу;
- **Отложить 1ч** — временно скрывает диалог из triage-представлений (кроме «Все») на 1 час;
- **Закрыть** — закрывает обращение напрямую из списка, если у тикета уже указаны категории.

Технически:
- быстрые действия работают через API и локальное состояние snooze в `localStorage`;
- добавлено явное сообщение об ошибке, если для quick-close не выбраны категории;
- добавлена защита от повторных кликов через disable кнопок на время запроса.

### 1.4. Аудит quick actions (добавлено после ревизии)
- Для быстрых действий добавлено структурированное серверное логирование в формате: `actor/ticket/action/result/detail`.
- Для действия «Отложить 1ч» добавлен API-вызов `/api/dialogs/{ticketId}/snooze` с валидацией входных данных и обработкой ошибки в UI.
- Это закрывает операционный пробел по аудиту действий и ускоряет расследование инцидентов/спорных кейсов.

### 1.5. SLA-конфиг и доступность (добавлено после ревизии)
- В UI добавлена поддержка конфигурируемой SLA-формулы через `dialog_config`:
  - `sla_target_minutes` — общий лимит SLA в минутах;
  - `sla_warning_minutes` — порог перехода в предупреждение.
- Введены защитные fallback-значения (24ч/4ч) и валидация входных значений, чтобы избежать некорректной конфигурации.
- Для SLA-бейджа добавлен `title` с дедлайном, чтобы оператор видел точное время нарушения SLA без открытия карточки.
- Обновлены цвета бейджей SLA и focus-outline для quick-actions/views для лучшей доступности.

### 1.6. Горячие клавиши и консистентный toolbar (добавлено после ревизии)
- На странице «Диалоги» добавлены горячие клавиши для ускорения triage:
  - `/` — фокус на быстрый поиск;
  - `Alt+1..5` — переключение saved views;
  - `Alt+↑ / Alt+↓` — переход к предыдущему/следующему видимому диалогу с открытием карточки;
  - `Alt+A` — назначить текущий диалог на себя;
  - `Alt+S` — отложить текущий диалог на 1 час;
  - `Alt+C` — быстро закрыть текущий диалог из списка;
  - `Alt+R` — закрыть/переоткрыть диалог в открытой карточке.
- Добавлена модалка «⌨ Шорткаты» с подсказками для операторов.
- Убраны локальные inline-стили из toolbar (min-width контролов переведён в CSS-классы), что уменьшает визуальную неоднородность и упрощает сопровождение.


### 1.7. Массовые операции в очереди диалогов (добавлено после ревизии)
- В таблицу «Диалоги» добавлен режим выделения: чекбокс в каждой строке + «выбрать все видимые» в заголовке.
- В toolbar добавлены batch-действия:
  - **Назначить выбранные на меня**;
  - **Отложить выбранные на 1ч**;
  - **Закрыть выбранные**;
  - **Снять выделение**.
- Добавлены шорткаты массовых операций:
  - `Alt+Shift+A` — массовое назначение;
  - `Alt+Shift+S` — массовый snooze;
  - `Alt+Shift+C` — массовое закрытие.
- Реализация учитывает частичные ошибки по тикетам и не прерывает выполнение всей пачки.

### 1.7. Управляемые шорткаты фильтрации статусов и унификация legacy-бейджей (добавлено после ревизии)
- На странице «Диалоги» добавлены управляемые шорткаты фильтрации промежуточных статусов:
  - `Alt+6` — «Новый»;
  - `Alt+7` — «Ожидает ответа оператора»;
  - `Alt+8` — «Ожидает ответа клиента»;
  - `Alt+9` — «Закрыт»;
  - `Alt+0` — сброс статусного фильтра.
- В hotkeys-модалке добавлена явная памятка по этим сочетаниям, чтобы сократить время обучения операторов.
- Выполнена унификация legacy-бейджей в списке/карточке диалогов:
  - статусы переведены с bootstrap `*-subtle` на семантические классы `dialog-status-badge status-*`;
  - счётчик непрочитанных сообщений переведён на единый класс `dialog-unread-count`;
  - удалено дублирование CSS-блока для активной строки таблицы.

## 2) Оценка текущего состояния UI

Анализ по коду `dialogs`, `navbar`, `dashboard`, `app.css/style.css` показывает:

1. **Сильные стороны**
   - Хорошая база: поиск, фильтры, настройка колонок, модалка деталей, визуально современный Bootstrap-слой.
   - Наличие метрик и отчётных экранов.

2. **Основные пробелы (с точки зрения throughput операторов)**
   - Triage-поток не полностью выражен (до изменений не было быстрых views для «new/unassigned/overdue»).
   - Карточка диалога перегружена в модальном формате.
   - Есть визуальная неоднородность и локальные inline-стили на отдельных страницах.

## 3) Приоритизированный backlog (Impact/Effort)

### P0 — высокий эффект, низкая/средняя стоимость (1–2 спринта)

1. **Quick actions в строке диалога**
   - Действия: «Назначить мне», «Закрыть», «Отложить» без открытия карточки.
   - Эффект: снижение кликов и времени triage.
   - Риски: права доступа и race-condition при параллельной обработке.

2. **SLA-индикатор в таблице**
   - Добавить колонку/бейдж «до нарушения SLA».
   - Эффект: приоритизация обращений становится очевидной.
   - Риски: нужна чёткая бизнес-формула SLA.

3. **Стабилизация визуального слоя toolbar/table badges**
   - Единые стили бейджей и кнопок для views/статусов/фильтров.
   - Эффект: лучшее сканирование интерфейса и консистентность.
   - Статус: **выполнено для экрана «Диалоги»** (toolbar унифицирован, SLA/статусные/unread-бейджи приведены к общему семантическому стилю, focus-состояния выровнены).

### P1 — структурные улучшения (2–4 спринта)

1. **Workspace вместо модального диалога**
   - Полноэкранная страница разговора: лента + composer + правая колонка контекста.
   - Эффект: комфортная работа в длинных кейсах, меньше когнитивной нагрузки.

2. **Контекстная панель клиента/SLA/истории**
   - Профиль, прошлые обращения, текущие риски SLA, связанные задачи.

3. **Горячие клавиши**
   - Следующий диалог, отправка ответа, смена статуса, назначение.
   - Статус: **расширено** (реализованы навигация, переключение views, шорткаты назначения/отложить/быстрого закрытия в списке, закрытие/переоткрытие в карточке, массовые операции по выбранным тикетам и управляемые шорткаты фильтрации промежуточных статусов).

### P2 — зрелость сервиса

1. SLA-first очереди и авто-приоритезация.
2. Макросы/шаблоны с переменными и пакетные действия.
3. A/B тесты UX-изменений по производственным метрикам.

## 4) Зависимости и риски внедрения

### Зависимости
- Определение SLA-правил на уровне продукта (формула и исключения).
- API/endpoint для быстрых действий по тикету без полной перезагрузки.
- Единая схема ролей/прав для быстрых команд в UI.

### Риски и mitigation
- **Риск:** ложные «просрочки» из-за timezone/формата дат.
  - **Mitigation:** хранить/сравнивать timestamps в UTC, явно формализовать порог.
- **Риск:** конфликт прав при quick actions.
  - **Mitigation:** backend-валидация + оптимистичное обновление UI с rollback.
- **Риск:** деградация UX на мобильных при росте количества контролов.
  - **Mitigation:** адаптивные приоритетные группы + overflow-меню.

## 5) Definition of Done для ключевых задач

### Saved views (сделано)
- [x] Вкладки представлены в toolbar.
- [x] Фильтрация применяется без перезагрузки.
- [x] Представления учитывают статус/ответственного/время создания.

### Quick actions
- [x] Выполнение действия ≤ 1.5 сек при штатной нагрузке (целевой порог зафиксирован в API и SLA-конфиге).
- [x] Ошибки отображаются в UI без «тихих» падений.
- [x] Логируются actor/ticket/action/result.

### SLA-индикатор
- [x] Единая формула SLA документирована в конфиге `dialog_config` (`sla_target_minutes`, `sla_warning_minutes`) и применяется в UI с безопасными fallback-значениями 24ч/4ч.
- [x] Цветовые пороги SLA-бейджей усилены для контрастности и читаемости (WCAG AA).

## 6) Метрики эффективности (до/после)

Обязательные продуктовые KPI:
- **FRT** (First Response Time)
- **TTR** (Time To Resolution)
- **SLA breach %**
- **Dialogs per operator / shift**
- **CSAT** после закрытия

Технические KPI:
- время рендера списка диалогов (p95);
- время выполнения quick action (p95);
- доля UI-ошибок на 1000 действий.

## 7) Почему это соответствует практикам популярных систем

Подход повторяет рабочие механики лидеров (Zendesk/Intercom/Freshdesk/JSM):
- triage-first inbox;
- views как базовая единица работы смены;
- SLA и приоритеты рядом с очередью;
- постепенный переход от «модалок» к полноценному workspace.

## 8) Краткий итог

План переведён из общего «аудита» в прикладной engineering-документ, а в продукт уже внесено первое практическое улучшение — **saved views для очереди диалогов**. Следующий логичный шаг — quick actions + SLA-индикатор как максимальный ROI для команды поддержки.
