# Подключение бота VK к Bender CRM

Ниже приведён краткий чек-лист, как подготовить сообщество VK, выдать токен и завести канал в панели управления.

## 1. Создайте и настройте сообщество
1. Перейдите в [панель управления VK](https://vk.com/groups) и создайте сообщество любого типа.
2. В настройках сообщества включите «Сообщения». Разрешите боту отвечать пользователям.
3. Перейдите в раздел **Работа с API → Ключи доступа** и создайте ключ с правами `messages`, `photos`, `docs`.
4. Сохраните:
   - токен сообщества;
   - ID сообщества (можно посмотреть в «Адреса» или в адресной строке `club123456789`). Именно числовое значение понадобится для запуска long poll.

## 2. Добавьте канал в панели Bender
1. Зайдите в раздел **Панель → Каналы**.
2. Заполните форму:
   - «Токен бота» — ключ доступа сообщества VK;
   - «Название в панели» — произвольное имя (например, «VK — Поддержка»);
   - «Платформа» — выберите `VK`;
   - «ID сообщества VK» — укажите числовой идентификатор (без `club`/`public`).
3. Нажмите **Добавить канал**. Имя сообщества подтянется автоматически, в таблице появится новый канал с пометкой `VK`.

## 3. Запустите процессинг сообщений
1. Установите зависимости (`pip install -r requirements.txt`).
2. Запустите обработчик VK-ботов:
   ```bash
   python vk_bot_support.py
   ```
   Скрипт поднимет long poll для каждого активного канала `VK` и начнёт принимать обращения.
3. Для остановки нажмите `Ctrl+C`. Скрипт аккуратно завершит поток long poll.

## 4. Как работает сценарий
- Диалог повторяет логику Telegram-бота: вопросы берутся из активного шаблона канала.
- Пользователь отвечает по шагам (бизнес → тип → город → локация) и в финале описывает проблему.
- Вложения (фото, документы, голосовые сообщения, видео) скачиваются и прикрепляются к заявке в общей базе.
- После отправки тикета клиент получает подтверждение с ID обращения.

## 5. Полезные советы
- Если сообщество не принимает сообщения, проверьте, включена ли функция «Сообщения сообщества» и есть ли у токена право `messages`.
- Чтобы обновить токен или ID, отредактируйте канал в панели либо удалите и создайте заново.
- В случае блокировки long poll (ошибка авторизации) убедитесь, что бот не выключен в настройках сообщества и токен не отозван.

После настройки VK-бот будет писать в те же таблицы `tickets`, `messages` и `chat_history`, что и Telegram, поэтому заявки доступны во всех панелях и аналитике.