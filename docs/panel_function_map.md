# Карта функциональных сценариев панели поддержки

Документ основан на анализе исходного Flask-приложения (`panel/app.py`) и связанных шаблонов (`panel/templates/*.html`). Карта отражает ключевые маршруты, используемые данные и назначение шаблонов. Она служит ориентиром для переноса логики в Spring Boot.

## Диалоги и рабочий стол

| Flask-маршрут | Шаблон | Основные данные | Назначение |
| --- | --- | --- | --- |
| `/` | `index.html` | Список тикетов с агрегированными полями (`tickets`, `total`, `resolved`, `pending`, `settings`) | Главный экран: таблица диалогов, счётчики статусов, доступ к истории сообщений и действиям над тикетами. |
| `/stats_data` | — (JSON) | Итоги по тикетам и группировка по каналам | Используется для обновления виджетов статистики на главной странице. |
| `/history` | — (JSON) | Лента сообщений (`chat_history`) с превью ответов | Подгрузка истории переписки для выбранного диалога. |
| `/tickets/<ticket_id>` | `dashboard.html` | Сводная информация по тикету и сообщения | Расширенный просмотр конкретного диалога. |

## История обращений

| Маршрут | Шаблон | Данные | Назначение |
| --- | --- | --- | --- |
| `/history` | — | Записи из `chat_history`, включая типы сообщений и вложения | AJAX-API для модального окна истории. |
| `/reply` | — | Тело ответа, идентификаторы тикета/канала | Отправка сообщения из панели поддержки. |

## База знаний

| Маршрут | Шаблон | Данные | Назначение |
| --- | --- | --- | --- |
| `/knowledge_base` (`/knowledge-base`) | `knowledge_base.html` | Перечень статей (`knowledge_articles`) и фильтры | Список статей, поиск и предпросмотр. |
| `/knowledge_base/new` | `knowledge_base_article.html` | Пустой объект статьи, списки справочников | Создание новой статьи. |
| `/knowledge_base/<id>` | `knowledge_base_article.html` | Данные статьи, вложения (`knowledge_article_files`) | Редактирование и публикация существующей статьи. |
| `/api/knowledge_base/articles` | — (JSON) | CRUD-операции над статьями и их файлами | REST-слой для SPA-компонентов редактора. |

## Публичные формы

| Маршрут | Шаблон | Данные | Назначение |
| --- | --- | --- | --- |
| `/public/forms/<channel_ref>` | `public_form.html` | Конфигурация канала (`channels.questions_cfg`), стартовый токен | UI формы для внешних пользователей. |
| `/api/public/forms/<channel_ref>/config` | — (JSON) | Структура вопросов, пресеты, идентификаторы канала | Инициализация формы. |
| `/api/public/forms/<channel_ref>/sessions` | — (JSON) | Ответы пользователя, сообщения, контактные данные | Создание обращения, запуск диалога и сохранение сессии (`web_form_sessions`). |
| `/api/public/forms/<channel_ref>/sessions/<token>` | — (JSON) | История сообщений и статусы тикета | Подгрузка существующего диалога по токену. |

## Уведомления и оповещения

| Маршрут | Шаблон | Данные | Назначение |
| --- | --- | --- | --- |
| `/api/notifications` | — (JSON) | Записи из `notifications` для пользователя | Список уведомлений в UI. |
| `/api/notifications/unread_count` | — (JSON) | Количество непрочитанных | Значок счётчика. |
| `/api/notifications/<id>/read` | — (JSON) | Обновление статуса | Пометка уведомления как прочитанного. |

## Аналитика

| Маршрут | Шаблон | Данные | Назначение |
| --- | --- | --- | --- |
| `/analytics` | `analytics.html` | Аггрегированная статистика по тикетам и клиентам | Двухвкладочный интерфейс аналитики (заявки / клиенты). |
| `/analytics/clients` и `/analytics/clients/<id>/details` | — (JSON/HTML) | Детализация по клиентам, экспорт CSV | Расширенный просмотр активности и выгрузка аналитики. |
| `/analytics/export` | — (stream) | CSV по тикетам | Выгрузка отчётов. |

## Прочие сценарии

| Маршрут | Шаблон | Данные | Назначение |
| --- | --- | --- | --- |
| `/channels` | `channels.html` | Управление каналами, токенами, лимитами | Настройка каналов и интеграций. |
| `/settings` | `settings.html` | Параметры справочников, сетевые настройки | Администрирование системных параметров. |
| `/tasks` | `tasks.html` | Задачи и исполнители | Канбан/список задач службы поддержки. |
| `/users`, `/roles` | `users_list.html` и др. | Пользователи панели, роли, права | Управление доступом. |

Документ покрывает основные зоны, требующие переноса на сервисный слой и внедрение в Spring MVC/Thymeleaf.
