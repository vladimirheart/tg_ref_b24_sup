<!-- panel/templates/_sidebar.html -->
<div class="sidebar" id="app-sidebar">
  <div class="sidebar-header">
    <span class="brand">
      <img src="{{ url_for('static', filename='bender-icon.svg') }}" alt="Ğ›Ğ¾Ğ³Ğ¾Ñ‚Ğ¸Ğ¿ Bender" class="brand-icon" />
      Bender
    </span>
    <div class="sidebar-actions" id="notify-bell-wrapper">
      <button id="bellBtn" class="icon-btn notify-btn" type="button" title="ĞĞ¿Ğ¾Ğ²ĞµÑ‰ĞµĞ½Ğ¸Ñ" aria-expanded="false">
        <span class="icon">ğŸ””</span>
        <span id="notify-count" class="notify-count" hidden>0</span>
      </button>
      <div id="notify-dropdown" class="notify-dropdown" hidden role="listbox" aria-label="ĞĞ¿Ğ¾Ğ²ĞµÑ‰ĞµĞ½Ğ¸Ñ"></div>
      <button id="pinSidebarBtn" class="icon-btn" type="button" title="ĞŸÑ€Ğ¸ĞºÑ€ĞµĞ¿Ğ¸Ñ‚ÑŒ/Ğ¾Ñ‚ĞºÑ€ĞµĞ¿Ğ¸Ñ‚ÑŒ">ğŸ“Œ</button>
      <button id="resetSidebarOrderBtn" class="icon-btn" type="button" title="Ğ’ĞµÑ€Ğ½ÑƒÑ‚ÑŒ Ğ¿Ğ¾Ñ€ÑĞ´Ğ¾Ğº Ğ¿Ğ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ">â†º</button>
    </div>
  </div>

  <nav class="sidebar-nav" aria-label="ĞÑĞ½Ğ¾Ğ²Ğ½Ğ°Ñ Ğ½Ğ°Ğ²Ğ¸Ğ³Ğ°Ñ†Ğ¸Ñ" title="ĞĞ°Ğ¶Ğ¼Ğ¸Ñ‚Ğµ Ğ½Ğ° Ğ¸ĞºĞ¾Ğ½ĞºÑƒ Â«â‡…Â», Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ¸Ğ·Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ Ñ€Ğ°ÑĞ¿Ğ¾Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†">
    <a href="/" class="nav-link" data-page-key="dialogs">
      <span class="icon">ğŸ’¬</span><span class="label">Ğ”Ğ¸Ğ°Ğ»Ğ¾Ğ³Ğ¸</span>
    </a>
    <a href="/tasks" class="nav-link" data-page-key="tasks">
      <span class="icon">âœ…</span><span class="label">Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ¸</span>
    </a>
    <a href="/clients" class="nav-link" data-page-key="clients">
      <span class="icon">ğŸ‘¥</span><span class="label">ĞšĞ»Ğ¸ĞµĞ½Ñ‚Ñ‹</span>
    </a>
    <a href="/object_passports" class="nav-link" data-page-key="object_passports">
      <span class="icon">ğŸ—ƒï¸</span><span class="label">ĞŸĞ°ÑĞ¿Ğ¾Ñ€Ñ‚ Ğ¾Ğ±ÑŠĞµĞºÑ‚Ğ¾Ğ²</span>
    </a>
   <a href="/knowledge_base" class="nav-link" data-page-key="knowledge_base">
      <span class="icon">ğŸ“š</span><span class="label">Ğ‘Ğ°Ğ·Ğ° Ğ·Ğ½Ğ°Ğ½Ğ¸Ğ¹</span>
    </a>
    <a href="/dashboard" class="nav-link" data-page-key="dashboard">
      <span class="icon">ğŸ“Š</span><span class="label">Ğ”Ğ°ÑˆĞ±Ğ¾Ñ€Ğ´</span>
    </a>
    <a href="/analytics" class="nav-link" data-page-key="analytics">
      <span class="icon">ğŸ“ˆ</span><span class="label">ĞĞ½Ğ°Ğ»Ğ¸Ñ‚Ğ¸ĞºĞ°</span>
    </a>
    <a href="/settings" class="nav-link" data-page-key="settings">
      <span class="icon">âš™ï¸</span><span class="label">ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸</span>
    </a>
  </nav>
  <div class="sidebar-footer">
    <div class="sidebar-order-controls">
      <button
        id="editSidebarOrderBtn"
        class="sidebar-order-btn"
        type="button"
        aria-label="Ğ ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¿Ğ¾Ñ€ÑĞ´Ğ¾Ğº"
        title="Ğ ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¿Ğ¾Ñ€ÑĞ´Ğ¾Ğº"
      >
        <span class="icon" aria-hidden="true">â‡…</span>
      </button>
    </div>
    <a href="{{ url_for('logout') }}" class="sidebar-logout-btn" role="button">
      <span class="icon" aria-hidden="true">ğŸšª</span>
      <span class="label">Ğ’Ñ‹Ğ¹Ñ‚Ğ¸</span>
    </a>
  </div>
</div>

<style id="modal-animations-style">
  .modal.fade .modal-dialog {
    --modal-scale-hidden: 0.92;
    --modal-scale-visible: 1;
    --modal-scale-closing: 0.9;
    --modal-scale: var(--modal-scale-hidden);
    transform: var(--modal-transform, scale(var(--modal-scale)));
    opacity: 0;
    transform-origin: center;
    transition: transform 0.25s ease, opacity 0.25s ease;
  }

  .modal.fade.show .modal-dialog,
  .modal.fade.showing .modal-dialog {
    --modal-scale: var(--modal-scale-visible);
    opacity: 1;
  }

  .modal.fade.modal-closing .modal-dialog {
    --modal-scale: var(--modal-scale-closing);
    opacity: 0;
  }

  .modal.fade.modal-closing {
    pointer-events: none;
  }
</style>

<script>
  (function setupModalAnimations() {
    if (window.__modalAnimationsInitialized) {
      return;
    }
    window.__modalAnimationsInitialized = true;

    const closingClass = 'modal-closing';

    const isAnimatedModal = (modal) =>
      modal && modal.classList && modal.classList.contains('modal') && modal.classList.contains('fade');

    const removeClosingState = (modal) => {
      if (!modal) return;
      modal.classList.remove(closingClass);
      if (modal.dataset) {
        delete modal.dataset.modalClosing;
      }
    };

    document.addEventListener(
      'show.bs.modal',
      (event) => {
        const modal = event.target;
        if (!isAnimatedModal(modal)) return;
        removeClosingState(modal);
      },
      true
    );

    document.addEventListener(
      'hide.bs.modal',
      (event) => {
        const modal = event.target;
        if (!isAnimatedModal(modal)) return;

        if (modal.dataset) {
          modal.dataset.modalClosing = 'true';
        }

        if (!modal.classList.contains(closingClass)) {
          modal.classList.add(closingClass);

          const dialog = modal.querySelector('.modal-dialog');
          if (dialog) {
            // Ğ¤Ğ¾Ñ€ÑĞ¸Ñ€ÑƒĞµĞ¼ reflow, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ°Ğ½Ğ¸Ğ¼Ğ°Ñ†Ğ¸Ñ Ñ‚Ğ¾Ñ‡Ğ½Ğ¾ Ğ·Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ğ»Ğ°ÑÑŒ
            void dialog.offsetHeight;
          }
        }
      },
      true
    );

    document.addEventListener(
      'hidePrevented.bs.modal',
      (event) => {
        const modal = event.target;
        if (!isAnimatedModal(modal)) return;
        removeClosingState(modal);
      },
      true
    );

    document.addEventListener(
      'hidden.bs.modal',
      (event) => {
        const modal = event.target;
        if (!isAnimatedModal(modal)) return;
        removeClosingState(modal);
      },
      true
    );
  })();
</script>
<script src="{{ url_for('static', filename='auto-copy.js') }}" defer></script>
