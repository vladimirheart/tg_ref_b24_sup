<!-- panel/templates/_sidebar.html -->
<div class="sidebar" id="app-sidebar">
  <div class="sidebar-header">
    <span class="brand">
      <img src="{{ url_for('static', filename='bender-icon.svg') }}" alt="–õ–æ–≥–æ—Ç–∏–ø Bender" class="brand-icon" />
      Bender
    </span>
    <div class="sidebar-actions" id="notify-bell-wrapper">
      <button id="bellBtn" class="icon-btn notify-btn" type="button" title="–û–ø–æ–≤–µ—â–µ–Ω–∏—è" aria-expanded="false">
        <span class="icon">üîî</span>
        <span id="notify-count" class="notify-count" hidden>0</span>
      </button>
      <div id="notify-dropdown" class="notify-dropdown" hidden role="listbox" aria-label="–û–ø–æ–≤–µ—â–µ–Ω–∏—è"></div>
      <button id="pinSidebarBtn" class="icon-btn" type="button" title="–ü—Ä–∏–∫—Ä–µ–ø–∏—Ç—å/–æ—Ç–∫—Ä–µ–ø–∏—Ç—å">üìå</button>
      <button id="resetSidebarOrderBtn" class="icon-btn" type="button" title="–í–µ—Ä–Ω—É—Ç—å –ø–æ—Ä—è–¥–æ–∫ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é">‚Ü∫</button>
    </div>
  </div>

  <nav class="sidebar-nav" aria-label="–û—Å–Ω–æ–≤–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è">
    <a href="/" class="nav-link" data-page-key="dialogs">
      <span class="icon">üí¨</span><span class="label">–î–∏–∞–ª–æ–≥–∏</span>
    </a>
    <a href="/tasks" class="nav-link" data-page-key="tasks">
      <span class="icon">‚úÖ</span><span class="label">–ó–∞–¥–∞—á–∏</span>
    </a>
    <a href="/clients" class="nav-link" data-page-key="clients">
      <span class="icon">üë•</span><span class="label">–ö–ª–∏–µ–Ω—Ç—ã</span>
    </a>
    <a href="/object_passports" class="nav-link" data-page-key="object_passports">
      <span class="icon">üóÉÔ∏è</span><span class="label">–ü–∞—Å–ø–æ—Ä—Ç –æ–±—ä–µ–∫—Ç–æ–≤</span>
    </a>
   <a href="/knowledge_base" class="nav-link" data-page-key="knowledge_base">
      <span class="icon">üìö</span><span class="label">–ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π</span>
    </a>
    <a href="/dashboard" class="nav-link" data-page-key="dashboard">
      <span class="icon">üìä</span><span class="label">–î–∞—à–±–æ—Ä–¥</span>
    </a>
    <a href="/analytics" class="nav-link" data-page-key="analytics">
      <span class="icon">üìà</span><span class="label">–ê–Ω–∞–ª–∏—Ç–∏–∫–∞</span>
    </a>
    <a href="/channels" class="nav-link" data-page-key="channels">
      <span class="icon">üì°</span><span class="label">–ö–∞–Ω–∞–ª—ã</span>
    </a>
    <a href="/settings" class="nav-link" data-page-key="settings">
      <span class="icon">‚öôÔ∏è</span><span class="label">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</span>
    </a>
  </nav>
  <div class="sidebar-footer">
    <div class="sidebar-order-controls">
      <button
        id="editSidebarOrderBtn"
        class="sidebar-order-btn"
        type="button"
        aria-label="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ—Ä—è–¥–æ–∫"
        title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ—Ä—è–¥–æ–∫"
      >
        <span class="icon" aria-hidden="true">‚áÖ</span>
      </button>
    </div>
    <button type="button" class="sidebar-account-btn" data-sidebar-change-password>
      <span class="icon" aria-hidden="true">üîê</span>
      <span class="label">–°–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å</span>
    </button>
    <a href="{{ url_for('logout') }}" class="sidebar-logout-btn" role="button">
      <span class="icon" aria-hidden="true">üö™</span>
      <span class="label">–í—ã–π—Ç–∏</span>
    </a>
  </div>
</div>

<div class="modal fade" id="changePasswordModal" tabindex="-1" aria-hidden="true" data-sidebar-password-modal>
  <div class="modal-dialog">
    <form class="modal-content" data-change-password-form>
      <div class="modal-header">
        <h5 class="modal-title">–°–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="–ó–∞–∫—Ä—ã—Ç—å"></button>
      </div>
      <div class="modal-body">
        <div class="alert alert-danger d-none" data-change-password-error role="alert"></div>
        <div class="alert alert-success d-none" data-change-password-success role="alert"></div>
        <div class="mb-3">
          <label class="form-label" for="changePasswordCurrent">–¢–µ–∫—É—â–∏–π –ø–∞—Ä–æ–ª—å</label>
          <input type="password" class="form-control" id="changePasswordCurrent" name="current_password" autocomplete="current-password" required>
        </div>
        <div class="mb-3">
          <label class="form-label" for="changePasswordNew">–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å</label>
          <input type="password" class="form-control" id="changePasswordNew" name="new_password" autocomplete="new-password" required minlength="8">
        </div>
        <div class="mb-3">
          <label class="form-label" for="changePasswordConfirm">–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å</label>
          <input type="password" class="form-control" id="changePasswordConfirm" name="confirm_password" autocomplete="new-password" required>
        </div>
        <p class="text-muted small mb-0">–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω–æ–π –ø–æ–ª–∏—Ç–∏–∫–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
        <button type="submit" class="btn btn-primary" data-change-password-submit>
          <span data-change-password-submit-text>–°–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å</span>
          <span class="spinner-border spinner-border-sm ms-2 d-none" role="status" aria-hidden="true" data-change-password-spinner></span>
        </button>
      </div>
    </form>
  </div>
</div>

<style id="modal-animations-style">
  .modal.fade .modal-dialog {
    --modal-scale-hidden: 0.92;
    --modal-scale-visible: 1;
    --modal-scale-closing: 0.9;
    --modal-scale: var(--modal-scale-hidden);
    transform: var(--modal-transform, scale(var(--modal-scale)));
    opacity: 0;
    transform-origin: center;
    transition: transform 0.25s ease, opacity 0.25s ease;
  }

  .modal.fade.show .modal-dialog,
  .modal.fade.showing .modal-dialog {
    --modal-scale: var(--modal-scale-visible);
    opacity: 1;
  }

  .modal.fade.modal-closing .modal-dialog {
    --modal-scale: var(--modal-scale-closing);
    opacity: 0;
  }

  .modal.fade.modal-closing {
    pointer-events: none;
  }
</style>

<script src="{{ url_for('static', filename='theme.js') }}"></script>
<script>
  (function setupModalAnimations() {
    if (window.__modalAnimationsInitialized) {
      return;
    }
    window.__modalAnimationsInitialized = true;

    const closingClass = 'modal-closing';

    const isAnimatedModal = (modal) =>
      modal && modal.classList && modal.classList.contains('modal') && modal.classList.contains('fade');

    const removeClosingState = (modal) => {
      if (!modal) return;
      modal.classList.remove(closingClass);
      if (modal.dataset) {
        delete modal.dataset.modalClosing;
      }
    };

    document.addEventListener(
      'show.bs.modal',
      (event) => {
        const modal = event.target;
        if (!isAnimatedModal(modal)) return;
        removeClosingState(modal);
      },
      true
    );

    document.addEventListener(
      'hide.bs.modal',
      (event) => {
        const modal = event.target;
        if (!isAnimatedModal(modal)) return;

        if (modal.dataset) {
          modal.dataset.modalClosing = 'true';
        }

        if (!modal.classList.contains(closingClass)) {
          modal.classList.add(closingClass);

          const dialog = modal.querySelector('.modal-dialog');
          if (dialog) {
            // –§–æ—Ä—Å–∏—Ä—É–µ–º reflow, —á—Ç–æ–±—ã –∞–Ω–∏–º–∞—Ü–∏—è —Ç–æ—á–Ω–æ –∑–∞–ø—É—Å—Ç–∏–ª–∞—Å—å
            void dialog.offsetHeight;
          }
        }
      },
      true
    );

    document.addEventListener(
      'hidePrevented.bs.modal',
      (event) => {
        const modal = event.target;
        if (!isAnimatedModal(modal)) return;
        removeClosingState(modal);
      },
      true
    );

    document.addEventListener(
      'hidden.bs.modal',
      (event) => {
        const modal = event.target;
        if (!isAnimatedModal(modal)) return;
        removeClosingState(modal);
      },
      true
    );
  })();
</script>
<script src="{{ url_for('static', filename='auto-copy.js') }}" defer></script>
<script src="{{ url_for('static', filename='column-reorder.js') }}" defer></script>
