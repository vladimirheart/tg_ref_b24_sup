<!-- panel/templates/analytics_clients.html -->
<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤ ‚Äî Bender</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
  <link href="{{ url_for('static', filename='style.css') }}" rel="stylesheet" />
  <link href="{{ url_for('static', filename='sidebar.css', v='2') }}" rel="stylesheet" />
  <style>
	  /* –°—Ç–∞—Ç–∏—á–Ω—ã–π –≤–µ—Ä—Ö–Ω–∏–π –±–∞—Ä */
	.navbar{
	  position: sticky;
	  top: 0;
	  z-index: 1030; /* –≤—ã—à–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ */
	}
	.sticky-header {
	  position: sticky;
	  top: 0;
	  background: #fff;
	  z-index: 1000;
	}

	.sticky-actions {
	  position: sticky;
	  top: 50px; /* –Ω–∏–∂–µ –∑–∞–≥–æ–ª–æ–≤–∫–∞ */
	  background: #fff;
	  z-index: 999;
	}
    .client-row:hover {
      background-color: #f8f9fa;
      cursor: pointer;
    }
    .name-block {
      font-size: 0.95em;
    }
    .name-block .db-name {
      color: #007bff;
      font-weight: 500;
    }
    .name-block .tg-name {
      color: #6c757d;
    }
    .filter-section {
      background: #f8f9fa;
      padding: 15px;
      border-radius: 5px;
      margin-bottom: 20px;
    }
    .filter-row {
      margin-bottom: 10px;
    }
    .sortable {
      cursor: pointer;
      position: relative;
    }
    .sortable:hover {
      background-color: #f0f0f0;
    }
    .table-container{
	  max-height: calc(100vh - var(--clients-header-h, 320px)); /* –≤–µ—Ä—Ö–Ω—è—è –≥—Ä–∞–Ω–∏—Ü–∞, —á—Ç–æ–±—ã –Ω–µ ¬´–≤—ã–ª–µ–∑–∞—Ç—å¬ª –∑–∞ —ç–∫—Ä–∞–Ω */
	  height: auto;             /* <‚Äî –∫–ª—é—á: –ø—Ä–∏ –º–∞–ª–æ–º —á–∏—Å–ª–µ —Å—Ç—Ä–æ–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å–∂–∏–º–∞–µ—Ç—Å—è –ø–æ –∫–æ–Ω—Ç–µ–Ω—Ç—É */
	  min-height: 0;
	  overflow-y: auto;
	  scrollbar-gutter: stable both-edges; /* –±–µ–∑ ¬´–¥—ë—Ä–≥–∞–Ω–∏–π¬ª –ø—Ä–∏ –ø–æ—è–≤–ª–µ–Ω–∏–∏ —Å–∫—Ä–æ–ª–ª–∞ */
	  overscroll-behavior: auto;
	}
	/* –õ–∏–ø–∫–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏ —Ç–∞–±–ª–∏—Ü—ã –≤–Ω—É—Ç—Ä–∏ –ø—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º–æ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ */
	.table-container thead th{
	  position: sticky;
	  top: 0;          /* –ø—Ä–∏–ª–∏–ø–∞—é—Ç –∫ –≤–µ—Ä—Ö—É –∏–º–µ–Ω–Ω–æ .table-container */
	  z-index: 2;      /* –ø–æ–≤–µ—Ä—Ö —Å—Ç—Ä–æ–∫ */
	  background: #212529; /* —Å–ø–ª–æ—à–Ω–æ–π —Ñ–æ–Ω –ø–æ–¥ .table-dark (–Ω–µ –¥–∞—ë–º –ø—Ä–æ—Å–≤–µ—á–∏–≤–∞—Ç—å) */
	  color: #fff;
	}
	.table-container thead th.sortable {
	  /* —Ñ–æ–Ω —É–∂–µ –µ—Å—Ç—å .table-dark th.sortable, –≤–∞–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å–ø–ª–æ—à–Ω–æ–π —Ñ–æ–Ω –¥–ª—è –ø–µ—Ä–µ–∫—Ä—ã—Ç–∏—è */
	  box-shadow: 0 2px 0 rgba(0,0,0,.05); /* —Ç–æ–Ω–∫–∞—è —Ç–µ–Ω—å –ø–æ–¥ —à–∞–ø–∫–æ–π, —á—Ç–æ–±—ã –≤–∏–∑—É–∞–ª—å–Ω–æ –æ—Ç–¥–µ–ª–∏—Ç—å */
	}

    .filter-badge {
      margin-right: 5px;
      margin-bottom: 5px;
      display: inline-block;
      font-size: 0.8em;
      padding: 4px 8px;
    }
    .select2-container {
      width: 100% !important;
    }
    .stats-card {
      transition: transform 0.2s;
    }
    .stats-card:hover {
      transform: translateY(-2px);
    }
    .custom-ticket-filter {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-top: 10px;
    }
    .custom-ticket-input {
      width: 100px;
    }
    .clients-counter {
      margin-top: 15px;
      padding: 10px;
      background-color: #f8f9fa;
      border-radius: 5px;
      font-weight: bold;
    }
    .table-dark th.sortable {
      background-color: #003366 !important;
      color: #fff !important;
      font-weight: bold;
      cursor: pointer;
      position: relative;
      transition: background-color 0.2s ease;
    }
    .table-dark th.sortable:hover {
      background-color: #cce6ff !important;
      color: #000 !important;
    }
    .sort-arrow {
      margin-left: 5px;
      color: #fff;
    }
    .table-dark th.sortable:hover .sort-arrow {
      color: #000;
    }
    .filter-btn {
      margin-bottom: 15px;
    }
    .ticket-count-total {
      font-weight: bold;
      background-color: #f8f9fa;
    }
    .pagination-controls {
      margin-top: 15px;
    }
    .export-btn {
      margin-left: 10px;
    }
    .active-filters-container {
      margin-bottom: 15px;
    }
    .spinner-border-sm {
      width: 1rem;
      height: 1rem;
    }
	/* –î–æ–±–∞–≤–ª–µ–Ω —Å—Ç–∏–ª—å –¥–ª—è –±–µ–π–¥–∂–µ–π —Å—Ç–∞—Ç—É—Å–æ–≤ –≤ —Å–ø–∏—Å–∫–µ, –µ—Å–ª–∏ status_data –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω */
	.status-badge-fallback {
		background-color: #6c757d; /* –°–µ—Ä—ã–π —Ü–≤–µ—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é */
		color: white;
		padding: 0.25em 0.4em;
		font-size: 75%;
		font-weight: 700;
		line-height: 1;
		text-align: center;
		white-space: nowrap;
		vertical-align: baseline;
		border-radius: 0.375rem;
	}
  </style>
	  <script>
  function recalcClientsHeaderHeight(){
    // –ë–µ—Ä—ë–º –≤—Å—ë —Å–≤–µ—Ä—Ö—É –¥–æ .table-container
    const container = document.querySelector('.container-fluid');
    const tableWrap = document.querySelector('.table-container');
    if(!container || !tableWrap) return;
    // –≤—ã—Å–æ—Ç–∞ ¬´—à–∞–ø–∫–∏¬ª = —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –æ—Ç –≤–µ—Ä—Ö–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –¥–æ –Ω–∞—á–∞–ª–∞ table-container + –Ω–µ–±–æ–ª—å—à–æ–π –∑–∞–ø–∞—Å
    const rectContainer = container.getBoundingClientRect();
    const rectTable = tableWrap.getBoundingClientRect();
    const headerH = (rectTable.top - rectContainer.top) + 56; // 56px ‚Äî –∑–∞–ø–∞—Å –ø–æ–¥ –ø–æ–ª—è/–∫–Ω–æ–ø–∫–∏
    document.documentElement.style.setProperty('--clients-header-h', `${Math.max(200, Math.round(headerH))}px`);
  }
  window.addEventListener('load', recalcClientsHeaderHeight);
  window.addEventListener('resize', recalcClientsHeaderHeight); // —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∏ –ø—Ä–∏ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –º–∞—Å—à—Ç–∞–±–∞
	// –µ—Å–ª–∏ –∫–æ–Ω—Ç–µ–Ω—Ç —Å–≤–µ—Ä—Ö—É –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –º–µ–Ω—è–µ—Ç—Å—è ‚Äî –Ω–∞–±–ª—é–¥–∞–µ–º –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ DOM
	document.addEventListener('DOMContentLoaded', () => {
	  recalcClientsHeaderHeight();
	  const observer = new MutationObserver(recalcClientsHeaderHeight);
	  observer.observe(document.body, {subtree:true, childList:true});
	});

</script>

</head>
<body class="with-sidebar sidebar-pinned">
  {% include "_sidebar.html" %}
  <main class="main-content container-fluid">
  <div class="container-fluid mt-4">
    <div class="d-flex justify-content-between align-items-center sticky-actions">
      <h2>üìà –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤</h2>
      <div>
        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#filtersModal">
          <i class="bi bi-funnel"></i> –§–∏–ª—å—Ç—Ä—ã
        </button>
        <button class="btn btn-success export-btn" data-bs-toggle="modal" data-bs-target="#exportModal">
          <i class="bi bi-file-earmark-excel"></i> –≠–∫—Å–ø–æ—Ä—Ç
        </button>
      </div>
    </div>
    <!-- –¢–∞–±–ª–∏—Ü–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤ -->
    <h4>üìã –í—Å–µ –∑–∞–ø–∏—Å–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤</h4> <!-- –£—Ç–æ—á–Ω–∏–ª –∑–∞–≥–æ–ª–æ–≤–æ–∫ -->
    <div class="table-container">
      <div class="table-responsive" data-column-reorder-container>
      <table class="table table-striped table-hover" id="clientsTable" data-column-reorderable data-reorder-key="analytics_clients"> <!-- –ò—Å–ø–æ–ª—å–∑—É–µ–º clients -->
        <thead class="table-dark">
		  <tr>
			<th class="sortable" data-sort="client">–ö–ª–∏–µ–Ω—Ç ‚Üï</th>
			<th class="sortable" data-sort="user_id">ID ‚Üï</th>
			<th class="sortable" data-sort="business">–ë–∏–∑–Ω–µ—Å ‚Üï</th>
			<th class="sortable" data-sort="location_type">–¢–∏–ø –ª–æ–∫–∞—Ü–∏–∏ ‚Üï</th>
			<th class="sortable" data-sort="city">–ì–æ—Ä–æ–¥ ‚Üï</th>
			<th class="sortable" data-sort="location_name">–õ–æ–∫–∞—Ü–∏—è ‚Üï</th>
			<th class="sortable" data-sort="category">–ö–∞—Ç–µ–≥–æ—Ä–∏—è ‚Üï</th>
			<th class="sortable" data-sort="status">–°—Ç–∞—Ç—É—Å ‚Üï</th>
			<th class="sortable" data-sort="cnt">–ó–∞—è–≤–æ–∫ ‚Üï</th>
		  </tr>
		</thead>
        <tbody>
		  <!-- –ò–∑–º–µ–Ω–µ–Ω–æ: –ò—Å–ø–æ–ª—å–∑—É–µ–º clients –∏ –∞–¥–∞–ø—Ç–∏—Ä—É–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Å—Ç—Ä–æ–∫ -->
          {% for c in clients %}
			<tr
			  onclick="window.location.href='/client/{{ c.user_id }}'"
			  style="cursor:pointer"
			  data-user-id="{{ c.user_id }}"
			  data-client="{{ (c.client_name or c.username) or '' }}"
			  data-business="{{ c.business or '' }}"
			  data-location-type="{{ c.location_type or '' }}"
			  data-city="{{ c.city or '' }}"
			  data-location="{{ c.location_name or '' }}"
			  data-category="{{ c.category or '' }}"
			  data-status="{{ c.status or '' }}"
			  data-cnt="{{ c.tickets }}"
			>
			  <td>{{ c.client_name or c.username or '‚Äî' }}</td>
			  <td>{{ c.user_id }}</td>
			  <td>{{ c.business or '‚Äî' }}</td>
			  <td>{{ c.location_type or '‚Äî' }}</td>
			  <td>{{ c.city or '‚Äî' }}</td>
			  <td>{{ c.location_name or '‚Äî' }}</td>
			  <td>{{ c.category or '‚Äî' }}</td>
			  <td>
				{% if status_data is defined and status_data %}
				  <span class="status-badge" style="background-color: {{ status_data.get(c.status, '#6c757d') }};">
					{{ c.status or '‚Äî' }}
				  </span>
				{% else %}
				  <span class="status-badge-fallback">{{ c.status or '‚Äî' }}</span>
				{% endif %}
			  </td>
			  <td><strong>{{ c.tickets }}</strong></td>
			</tr>
			{% endfor %}
          <!-- –°—Ç—Ä–æ–∫–∞ —Å –∏—Ç–æ–≥–æ–≤—ã–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –∫–ª–∏–µ–Ω—Ç–æ–≤ (–∑–∞–ø–∏—Å–µ–π) -->
          <tr class="ticket-count-total">
            <td colspan="8" class="text-end"><strong>–í—Å–µ–≥–æ –∑–∞–ø–∏—Å–µ–π –∫–ª–∏–µ–Ω—Ç–æ–≤:</strong></td>
            <td><strong id="totalTicketsCount">{{ total_tickets }}</strong></td> <!-- –ò—Å–ø–æ–ª—å–∑—É–µ–º total_tickets -->
          </tr>
        </tbody>
      </table>
      </div>
    </div>
    <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è –∏ —Å—á–µ—Ç—á–∏–∫ -->
    <div class="d-flex justify-content-between align-items-center mt-3">
      <div class="clients-counter" id="clientsCounter">
        –ü–æ–∫–∞–∑–∞–Ω–æ: <span id="visibleClientsCount">{{ clients | length }}</span> –∏–∑ <span id="totalClientsCount">{{ clients | length }}</span> –∑–∞–ø–∏—Å–µ–π <!-- –ò—Å–ø–æ–ª—å–∑—É–µ–º clients -->
      </div>
	  <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è -->
		<nav aria-label="–°—Ç—Ä–∞–Ω–∏—Ü—ã" class="mt-2">
		  <ul class="pagination justify-content-center" id="clientsPagination"></ul>
		</nav>
      <div class="pagination-controls">
	   <label>–ó–∞–ø–∏—Å–µ–π –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ:</label> <!-- –£—Ç–æ—á–Ω–∏–ª —Ç–µ–∫—Å—Ç -->
        <select class="form-select form-select-sm d-inline-block w-auto" id="pageSizeSelect">
          <option value="20">20</option>
          <option value="50">50</option>
          <option value="100">100</option>
          <option value="200">200</option>
          <option value="500">500</option>
        </select>
      </div>
	  
    </div>
    <!-- –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º –∏ –±–∏–∑–Ω–µ—Å–∞–º -->
    <div class="row mt-4">
		<!-- –ò–∑–º–µ–Ω–µ–Ω–æ: –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–ø–∏—Å–∫–∏ —Å—Ç–∞—Ç—É—Å–æ–≤ –∏ –±–∏–∑–Ω–µ—Å–æ–≤ –∏–∑ –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö clients -->
		<!-- –≠—Ç–æ —Ç—Ä–µ–±—É–µ—Ç –Ω–µ–º–Ω–æ–≥–æ –ª–æ–≥–∏–∫–∏ –≤ Jinja2 -->
      <div class="col-md-6">
        <h4>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º</h4> <!-- –£–ø—Ä–æ—Å—Ç–∏–ª –∑–∞–≥–æ–ª–æ–≤–æ–∫ -->
        <div class="card">
          <div class="card-body">
            <ul class="list-group">
			  <!-- –°–æ–∑–¥–∞–µ–º —Å–ª–æ–≤–∞—Ä—å –¥–ª—è –ø–æ–¥—Å—á–µ—Ç–∞ -->
			  {% set status_counts = {} %}
			  {% for item in clients %}
				{% set current_count = status_counts.get(item.status, 0) %}
				{% set _ = status_counts.update({item.status: current_count + item.tickets}) %}
			  {% endfor %}
			  <!-- –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã -->
			  {% for status, cnt in status_counts.items() %}
              <li class="list-group-item d-flex justify-content-between align-items-center">
                {{ status or '–ù–µ —É–∫–∞–∑–∞–Ω' }}
                <span class="badge bg-info text-dark rounded-pill">{{ cnt }}</span>
              </li>
			  {% else %}
				<li class="list-group-item">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</li>
			  {% endfor %}
            </ul>
          </div>
        </div>
      </div>
      <div class="col-md-6">
        <h4>üè¢ –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –±–∏–∑–Ω–µ—Å–∞–º</h4> <!-- –£–ø—Ä–æ—Å—Ç–∏–ª –∑–∞–≥–æ–ª–æ–≤–æ–∫ -->
        <div class="card">
          <div class="card-body">
            <ul class="list-group">
			  <!-- –°–æ–∑–¥–∞–µ–º —Å–ª–æ–≤–∞—Ä—å –¥–ª—è –ø–æ–¥—Å—á–µ—Ç–∞ -->
			  {% set business_counts = {} %}
			  {% for item in clients %}
				{% set current_count = business_counts.get(item.business, 0) %}
				{% set _ = business_counts.update({item.business: current_count + item.tickets}) %}
			  {% endfor %}
			  <!-- –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã -->
			  {% for business, cnt in business_counts.items() %}
              <li class="list-group-item d-flex justify-content-between align-items-center">
                {{ business or '–ù–µ —É–∫–∞–∑–∞–Ω' }}
                <span class="badge bg-secondary rounded-pill">{{ cnt }}</span>
              </li>
			  {% else %}
				<li class="list-group-item">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</li>
			  {% endfor %}
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ: —Ñ–∏–ª—å—Ç—Ä—ã -->
  <!-- ... (–æ—Å—Ç–∞–ª—å–Ω–∞—è —á–∞—Å—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤ –æ—Å—Ç–∞–µ—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π, –Ω–æ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ ID/–∏–º–µ–Ω–∏ –Ω–µ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏) ... -->
  <div class="modal fade" id="filtersModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">–§–∏–ª—å—Ç—Ä—ã –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤</h5> <!-- –£—Ç–æ—á–Ω–∏–ª –∑–∞–≥–æ–ª–æ–≤–æ–∫ -->
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <div class="row filter-row">
			<!-- –ò–∑–º–µ–Ω–µ–Ω–æ: –£–±—Ä–∞–ª —Ñ–∏–ª—å—Ç—Ä—ã, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç —Å –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ -->
			<!--
            <div class="col-md-6 mb-3">
              <label>ID –∫–ª–∏–µ–Ω—Ç–∞</label>
              <input type="text" class="form-control" id="filterUserId" placeholder="–í–≤–µ–¥–∏—Ç–µ ID">
            </div>
            <div class="col-md-6 mb-3">
              <label>–Æ–∑–µ—Ä–Ω–µ–π–º</label>
              <input type="text" class="form-control" id="filterUsername" placeholder="–í–≤–µ–¥–∏—Ç–µ —é–∑–µ—Ä–Ω–µ–π–º">
            </div>
            <div class="col-md-6 mb-3">
              <label>–ò–º—è –≤ –ë–î</label>
              <input type="text" class="form-control" id="filterClientName" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è">
            </div>
			-->
			<!-- –û—Å—Ç–∞–≤–∏–ª —Ñ–∏–ª—å—Ç—Ä –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É, —Ç–∞–∫ –∫–∞–∫ –æ–Ω –º–æ–∂–µ—Ç –±—ã—Ç—å –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω -->
            <div class="col-md-6 mb-3">
              <label>–ö–æ–ª-–≤–æ –∫–ª–∏–µ–Ω—Ç–æ–≤</label> <!-- –£—Ç–æ—á–Ω–∏–ª —Ç–µ–∫—Å—Ç -->
              <select class="form-select" id="filterTicketCount">
                <option value="">–í—Å–µ</option>
                <option value="1">1 –∫–ª–∏–µ–Ω—Ç</option>
                <option value="2">2+ –∫–ª–∏–µ–Ω—Ç–æ–≤</option>
                <option value="5">5+ –∫–ª–∏–µ–Ω—Ç–æ–≤</option>
                <option value="10">10+ –∫–ª–∏–µ–Ω—Ç–æ–≤</option>
                <option value="custom">–°–≤–æ—ë –∑–Ω–∞—á–µ–Ω–∏–µ</option>
              </select>
              <!-- –ü–æ–ª–µ –¥–ª—è –≤–≤–æ–¥–∞ —Å–≤–æ–µ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è -->
              <div class="custom-ticket-filter" id="customTicketFilter" style="display: none;">
                <input type="number" min="1" class="form-control custom-ticket-input" id="customTicketValue" placeholder="–ß–∏—Å–ª–æ">
                <select class="form-select" id="customTicketOperator">
                  <option value=">=">>= (–º–∏–Ω–∏–º—É–º)</option>
                  <option value="==">== (—Ç–æ—á–Ω–æ)</option>
                  <option value="<="><= (–º–∞–∫—Å–∏–º—É–º)</option>
                </select>
              </div>
            </div>
			<!-- –î–æ–±–∞–≤–∏–ª —Ñ–∏–ª—å—Ç—Ä—ã –¥–ª—è –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö -->
			<div class="col-md-6 mb-3">
              <label>–ë–∏–∑–Ω–µ—Å</label>
              <select class="form-select filter-select" id="filterBusiness" multiple>
                {% for business in businesses %}
                <option value="{{ business }}">{{ business }}</option>
                {% endfor %}
              </select>
            </div>
            <div class="col-md-6 mb-3">
              <label>–¢–∏–ø –ª–æ–∫–∞—Ü–∏–∏</label>
              <select class="form-select filter-select" id="filterLocationType" multiple>
                {% for type in location_types %}
                <option value="{{ type }}">{{ type }}</option>
                {% endfor %}
              </select>
            </div>
            <div class="col-md-6 mb-3">
              <label>–ì–æ—Ä–æ–¥</label>
              <select class="form-select filter-select" id="filterCity" multiple>
                {% for city in cities %}
                <option value="{{ city }}">{{ city }}</option>
                {% endfor %}
              </select>
            </div>
            <div class="col-md-6 mb-3">
              <label>–õ–æ–∫–∞—Ü–∏—è</label>
              <select class="form-select filter-select" id="filterLocation" multiple>
                {% for location in locations %}
                <option value="{{ location }}">{{ location }}</option>
                {% endfor %}
              </select>
            </div>
            <div class="col-md-6 mb-3">
              <label>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
              <select class="form-select filter-select" id="filterCategory" multiple>
                {% for category in categories %}
                <option value="{{ category }}">{{ category }}</option>
                {% endfor %}
              </select>
            </div>
            <div class="col-md-6 mb-3">
              <label>–°—Ç–∞—Ç—É—Å</label>
              <select class="form-select filter-select" id="filterStatus" multiple>
                {% for status in statuses %}
                <option value="{{ status }}">{{ status }}</option>
                {% endfor %}
              </select>
            </div>
          </div>
          <!-- –ê–∫—Ç–∏–≤–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã -->
          <div class="mt-3" id="activeFilters" style="display: none;">
            <h6>–ê–∫—Ç–∏–≤–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã:</h6>
            <div id="filterBadges"></div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" onclick="resetFilters()">–°–±—Ä–æ—Å–∏—Ç—å</button>
          <button type="button" class="btn btn-primary" onclick="applyFilters()">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
        </div>
      </div>
    </div>
  </div>
  <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ: —ç–∫—Å–ø–æ—Ä—Ç -->
  <!-- ... (–º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —ç–∫—Å–ø–æ—Ä—Ç–∞ –æ—Å—Ç–∞–µ—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) ... -->
  <div class="modal fade" id="exportModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">–≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <div class="mb-3">
          <label class="form-label">–§–æ—Ä–º–∞—Ç:</label>
          <select class="form-select" id="exportFormat">
            <option value="xlsx">Excel (.xlsx)</option>
            <option value="csv">CSV</option>
          </select>
        </div>
        <div class="mb-3">
          <div class="form-check">
            <input class="form-check-input" type="checkbox" id="exportFilteredData">
            <label class="form-check-label" for="exportFilteredData">–¢–æ–ª—å–∫–æ –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</label>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
        <button type="button" class="btn btn-success" onclick="exportData()">–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
			</div>
		</div>
	</div>
	</div>
  <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ: –¥–µ—Ç–∞–ª–∏ –∫–ª–∏–µ–Ω—Ç–∞ -->
  <!-- ... (–º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–µ—Ç–∞–ª–µ–π –∫–ª–∏–µ–Ω—Ç–∞ –Ω–µ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏) ... -->
  <div class="modal fade" id="clientDetailsModal" tabindex="-1">
    <div class="modal-dialog modal-lg modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="clientModalTitle">–ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏</h5> <!-- –£–ø—Ä–æ—Å—Ç–∏–ª –∑–∞–≥–æ–ª–æ–≤–æ–∫ -->
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body" id="clientDetailsBody">
          <p>–ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ –Ω–∞ —ç—Ç–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É "–ö–ª–∏–µ–Ω—Ç—ã" –∏–ª–∏ "–ó–∞—è–≤–∫–∏" –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –¥–µ—Ç–∞–ª–µ–π.</p> <!-- –û–±–Ω–æ–≤–∏–ª —Ç–µ–∫—Å—Ç -->
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–ó–∞–∫—Ä—ã—Ç—å</button>
        </div>
      </div>
    </div>
  </div>
  <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/i18n/ru.js"></script>
  <script>
    // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è —Ñ–∏–ª—å—Ç—Ä–æ–≤
    let customFilter = {
      value: null,
      operator: '>='
    };
	// –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ñ–∏–ª—å—Ç—Ä–æ–≤ –ø–æ –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –¥–∞–Ω–Ω—ã–º
	let multiSelectFiltersState = {
		business: [],
		location_type: [],
		city: [],
		location: [],
		category: [],
		status: []
	};
    // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –ø–∞–≥–∏–Ω–∞—Ü–∏–∏
    let currentPage = 1;
    let pageSize = 20;
    let filteredClients = []; // –ò—Å–ø–æ–ª—å–∑—É–µ–º clients
	let originalClients = []; // –ò—Å–ø–æ–ª—å–∑—É–µ–º clients
    // –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤ –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞
    function prepareFiltersForExport() {
      const filters = {
		// –§–∏–ª—å—Ç—Ä—ã –ø–æ –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –¥–∞–Ω–Ω—ã–º
		business: $('#filterBusiness').val() || [],
		location_type: $('#filterLocationType').val() || [],
		city: $('#filterCity').val() || [],
		location: $('#filterLocation').val() || [],
		category: $('#filterCategory').val() || [],
		status: $('#filterStatus').val() || [],
        ticketCount: $('#filterTicketCount').val() // –§–∏–ª—å—Ç—Ä –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É
      };
      // –î–æ–±–∞–≤–ª—è–µ–º –∫–∞—Å—Ç–æ–º–Ω—ã–π —Ñ–∏–ª—å—Ç—Ä –µ—Å–ª–∏ –æ–Ω –∞–∫—Ç–∏–≤–µ–Ω
      if (filters.ticketCount === 'custom' && customFilter.value !== null) {
        filters.customTicketValue = customFilter.value;
        filters.customTicketOperator = customFilter.operator;
      }
      return filters;
    }
		// –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö
		async function exportData() {
		const format = document.getElementById('exportFormat').value;
		const exportFiltered = document.getElementById('exportFilteredData')?.checked || false;
  
		// –°–æ–±–∏—Ä–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ñ–∏–ª—å—Ç—Ä–æ–≤
		const filters = prepareFiltersForExport();
  
		try {
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
    const exportBtn = document.querySelector('#exportModal .btn-success');
    const originalText = exportBtn.innerHTML;
    exportBtn.innerHTML = '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> –≠–∫—Å–ø–æ—Ä—Ç...';
    exportBtn.disabled = true;

    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ —Å–µ—Ä–≤–µ—Ä –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞
    const response = await fetch('/analytics/clients/export', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({
        format: format,
        filters: filters,
        exportFiltered: exportFiltered
      })
    });

    if (response.ok) {
      // –°–∫–∞—á–∏–≤–∞–µ–º —Ñ–∞–π–ª
      const blob = await response.blob();
      const url = window.URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.style.display = 'none';
      a.href = url;
      
      // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∏–º—è —Ñ–∞–π–ª–∞
      const date = new Date().toISOString().slice(0, 10);
      const extension = format === 'xlsx' ? 'xlsx' : 'csv';
      a.download = `clients_analytics_${date}.${extension}`;
      
      document.body.appendChild(a);
      a.click();
      window.URL.revokeObjectURL(url);
      document.body.removeChild(a);
    } else {
      const errorData = await response.json();
      throw new Error(errorData.error || '–û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞ –¥–∞–Ω–Ω—ã—Ö');
    }
  } catch (error) {
    console.error('Export error:', error);
    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —ç–∫—Å–ø–æ—Ä—Ç–µ –¥–∞–Ω–Ω—ã—Ö: ' + error.message);
  } finally {
    // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–Ω–æ–ø–∫—É
    const exportBtn = document.querySelector('#exportModal .btn-success');
    exportBtn.innerHTML = '–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å';
    exportBtn.disabled = false;
    
    // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
    bootstrap.Modal.getInstance(document.getElementById('exportModal')).hide();
  }
}
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    $(document).ready(function() {
	  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Select2 –¥–ª—è –Ω–æ–≤—ã—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤
	  $('.filter-select').select2({
		placeholder: "–í—ã–±–µ—Ä–∏—Ç–µ...",
		allowClear: true,
		language: "ru",
		dropdownParent: $('#filtersModal')
	  });
      // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ñ–∏–ª—å—Ç—Ä–æ–≤
      $('#filterTicketCount').on('change', function() { // –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π ID
        // –ü–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å –ø–æ–ª–µ –¥–ª—è –≤–≤–æ–¥–∞ —Å–≤–æ–µ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è
        if ($('#filterTicketCount').val() === 'custom') {
          $('#customTicketFilter').show();
        } else {
          $('#customTicketFilter').hide();
          customFilter.value = null;
        }
      });
      // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
      $('#pageSizeSelect').on('change', function() {
        pageSize = parseInt(this.value);
        applyPagination();
      });
      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
      initSorting();
      // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
      filteredClients = Array.from(document.querySelectorAll('#clientsTable tbody tr:not(.ticket-count-total)'));
	  originalClients = Array.from(filteredClients); // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π —Å–ø–∏—Å–æ–∫
      // –í—ã—á–∏—Å–ª—è–µ–º –∏—Å—Ö–æ–¥–Ω–æ–µ –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞—è–≤–æ–∫
      calculateTotalTickets();
    });
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –æ–±—â–µ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∑–∞—è–≤–æ–∫
    function calculateTotalTickets() {
      let total = 0;
      filteredClients.forEach(row => {
        total += parseInt(row.getAttribute('data-cnt')); // –ò—Å–ø–æ–ª—å–∑—É–µ–º data-cnt
      });
      document.getElementById('totalTicketsCount').textContent = total;
    }
    // –ü—Ä–∏–º–µ–Ω–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π —Ñ–∏–ª—å—Ç—Ä
    function applyCustomFilter() {
      const value = parseInt($('#customTicketValue').val());
      const operator = $('#customTicketOperator').val();
      if (isNaN(value) || value < 1) {
        alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ —á–∏—Å–ª–æ (–º–∏–Ω–∏–º—É–º 1)');
        return false; // –í–æ–∑–≤—Ä–∞—â–∞–µ–º false –ø—Ä–∏ –æ—à–∏–±–∫–µ
      }
      customFilter.value = value;
      customFilter.operator = operator;
	  return true; // –£—Å–ø–µ—à–Ω–æ –ø—Ä–∏–º–µ–Ω–µ–Ω
    }
    // –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤
    function applyFilters() {
		// –°–æ–±–∏—Ä–∞–µ–º –≤—Å–µ —Ñ–∏–ª—å—Ç—Ä—ã
		const filters = {
			// –§–∏–ª—å—Ç—Ä—ã –ø–æ –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –¥–∞–Ω–Ω—ã–º
			business: $('#filterBusiness').val() || [],
			location_type: $('#filterLocationType').val() || [],
			city: $('#filterCity').val() || [],
			location: $('#filterLocation').val() || [],
			category: $('#filterCategory').val() || [],
			status: $('#filterStatus').val() || [],
			// –§–∏–ª—å—Ç—Ä –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É
			ticketCount: $('#filterTicketCount').val()
		};
		// –ï—Å–ª–∏ –≤—ã–±—Ä–∞–Ω –∫–∞—Å—Ç–æ–º–Ω—ã–π —Ñ–∏–ª—å—Ç—Ä, –ø—Ä–∏–º–µ–Ω—è–µ–º –µ–≥–æ
		if (filters.ticketCount === 'custom') {
			if (!applyCustomFilter()) {
				return; // –ü—Ä–µ—Ä—ã–≤–∞–µ–º, –µ—Å–ª–∏ –∫–∞—Å—Ç–æ–º–Ω—ã–π —Ñ–∏–ª—å—Ç—Ä –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω
			}
		}
		// –ü–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã
		showActiveFilters(filters);
		// –ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã –∫ –¥–∞–Ω–Ω—ã–º
		filteredClients = originalClients.filter(row => {
			const business = row.getAttribute('data-business') || '';
			const locationType = row.getAttribute('data-location-type') || '';
			const city = row.getAttribute('data-city') || '';
			const location = row.getAttribute('data-location') || '';
			const category = row.getAttribute('data-category') || '';
			const status = row.getAttribute('data-status') || '';
			const ticketCount = parseInt(row.getAttribute('data-cnt')); // –ò—Å–ø–æ–ª—å–∑—É–µ–º data-cnt
			let show = true;
			// –§–∏–ª—å—Ç—Ä—ã –ø–æ –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –¥–∞–Ω–Ω—ã–º
			if (filters.business.length > 0 && !filters.business.includes(business)) show = false;
			if (filters.location_type.length > 0 && !filters.location_type.includes(locationType)) show = false;
			if (filters.city.length > 0 && !filters.city.includes(city)) show = false;
			if (filters.location.length > 0 && !filters.location.includes(location)) show = false;
			if (filters.category.length > 0 && !filters.category.includes(category)) show = false;
			if (filters.status.length > 0 && !filters.status.includes(status)) show = false;
			// –§–∏–ª—å—Ç—Ä –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –∫–ª–∏–µ–Ω—Ç–æ–≤
			if (filters.ticketCount) {
				if (filters.ticketCount === 'custom' && customFilter.value !== null) {
					// –ü—Ä–∏–º–µ–Ω—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π —Ñ–∏–ª—å—Ç—Ä
					if (customFilter.operator === '>=' && ticketCount < customFilter.value) {
						show = false;
					} else if (customFilter.operator === '==' && ticketCount !== customFilter.value) {
						show = false;
					} else if (customFilter.operator === '<=' && ticketCount > customFilter.value) {
						show = false;
					}
				} else {
					// –ü—Ä–∏–º–µ–Ω—è–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã
					const minCount = parseInt(filters.ticketCount);
					if (minCount === 1 && ticketCount !== 1) {
						show = false;
					} else if (minCount === 2 && ticketCount < 2) {
						show = false;
					} else if (minCount === 5 && ticketCount < 5) {
						show = false;
					} else if (minCount === 10 && ticketCount < 10) {
						show = false;
					}
					refreshClientsPagination();
				}
			}
			return show;
		});
		// –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º –∏—Ç–æ–≥–æ–≤–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞—è–≤–æ–∫
		calculateTotalTickets();
		// –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø–∞–≥–∏–Ω–∞—Ü–∏—é –∏ –ø—Ä–∏–º–µ–Ω—è–µ–º
		currentPage = 1;
		applyPagination();
		// –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫–∏
		updateClientsCounter(filteredClients.length);
		// –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
		bootstrap.Modal.getInstance(document.getElementById('filtersModal')).hide();
	}
    // –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏
    function applyPagination() {
      const tbody = document.querySelector('#clientsTable tbody');
      const totalRow = tbody.querySelector('.ticket-count-total');
      // –û—á–∏—â–∞–µ–º —Ç–∞–±–ª–∏—Ü—É, –∫—Ä–æ–º–µ –∏—Ç–æ–≥–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏
      Array.from(tbody.querySelectorAll('tr:not(.ticket-count-total)')).forEach(row => row.remove());
      // –í—ã—á–∏—Å–ª—è–µ–º –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
      const startIndex = (currentPage - 1) * pageSize;
      const endIndex = Math.min(startIndex + pageSize, filteredClients.length);
      // –î–æ–±–∞–≤–ª—è–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã –¥–ª—è —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
      for (let i = startIndex; i < endIndex; i++) {
        tbody.insertBefore(filteredClients[i].cloneNode(true), totalRow);
      }
      // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫ –≤–∏–¥–∏–º—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤/–∑–∞–ø–∏—Å–µ–π
      document.getElementById('visibleClientsCount').textContent = endIndex - startIndex; // –¢–æ–ª—å–∫–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
    }
    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤
    function updateClientsCounter(visibleCount) {
      // const totalCount = {{ clients | length }}; // –≠—Ç–æ –Ω–µ –∏–∑–º–µ–Ω–∏—Ç—Å—è –ø—Ä–∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
	  const totalCount = originalClients.length; // –ò—Å–ø–æ–ª—å–∑—É–µ–º –¥–ª–∏–Ω—É –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞
      const f = document.getElementById('filteredClientsCount');
	  if (f) f.textContent = filteredClients.length;
      document.getElementById('totalClientsCount').textContent = totalCount;
    }
    // –ü–æ–∫–∞–∑–∞—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã
	function showActiveFilters(filters) {
		const badgesContainer = document.getElementById('filterBadges');
		const activeBadgesContainer = document.getElementById('activeFiltersBadges');
		if (!badgesContainer || !activeBadgesContainer) return;
		badgesContainer.innerHTML = '';
		activeBadgesContainer.innerHTML = '';
		let hasActiveFilters = false;
		// –§–∏–ª—å—Ç—Ä—ã –ø–æ –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –¥–∞–Ω–Ω—ã–º
		const multiSelectFilters = [
			{ key: 'business', label: '–ë–∏–∑–Ω–µ—Å' },
			{ key: 'location_type', label: '–¢–∏–ø –ª–æ–∫–∞—Ü–∏–∏' },
			{ key: 'city', label: '–ì–æ—Ä–æ–¥' },
			{ key: 'location', label: '–õ–æ–∫–∞—Ü–∏—è' },
			{ key: 'category', label: '–ö–∞—Ç–µ–≥–æ—Ä–∏—è' },
			{ key: 'status', label: '–°—Ç–∞—Ç—É—Å' }
		];
		multiSelectFilters.forEach(filter => {
			if (filters[filter.key] && filters[filter.key].length > 0) {
				hasActiveFilters = true;
				filters[filter.key].forEach(value => {
					if (value) {
						const badge = createFilterBadge(filter.label, value, filter.key, value);
						badgesContainer.appendChild(badge);
						activeBadgesContainer.appendChild(badge.cloneNode(true));
					}
				});
			}
		});
		// –§–∏–ª—å—Ç—Ä –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É
		if (filters.ticketCount) {
			hasActiveFilters = true;
			let label;
			if (filters.ticketCount === 'custom' && customFilter.value !== null) {
				const operatorSymbols = {
					'>=': '‚â•',
					'==': '=',
					'<=': '‚â§'
				};
				label = `${operatorSymbols[customFilter.operator]} ${customFilter.value} –∫–ª–∏–µ–Ω—Ç–æ–≤`;
			} else {
				label = getTicketCountLabel(filters.ticketCount);
			}
			const badge = createFilterBadge('–ö–ª–∏–µ–Ω—Ç–æ–≤', label, 'ticketCount'); // –ò–∑–º–µ–Ω–∏–ª –º–µ—Ç–∫—É
			badgesContainer.appendChild(badge);
			activeBadgesContainer.appendChild(badge.cloneNode(true));
		}
		document.getElementById('activeFilters').style.display = hasActiveFilters ? 'block' : 'none';
		activeBadgesContainer.style.display = hasActiveFilters ? 'block' : 'none';
	}
	// –°–æ–∑–¥–∞—Ç—å –±–µ–π–¥–∂ —Ñ–∏–ª—å—Ç—Ä–∞ (–æ–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è –¥–ª—è –º—É–ª—å—Ç–∏—Å–µ–ª–µ–∫—Ç–æ–≤)
	function createFilterBadge(label, value, filterKey, filterValue = null) {
		const badge = document.createElement('span');
		badge.className = 'badge bg-primary filter-badge';
		// –ï—Å–ª–∏ filterValue –∑–∞–¥–∞–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ–º –µ–≥–æ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è
		const removeValue = filterValue !== null ? filterValue : value;
		badge.innerHTML = `${label}: ${value} 
			<span style="cursor:pointer; margin-left:5px;" onclick="removeFilter('${filterKey}', '${removeValue}')">√ó</span>`;
		return badge;
	}
	// –ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—Å—Ç –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∑–∞—è–≤–æ–∫/–∫–ª–∏–µ–Ω—Ç–æ–≤
	function getTicketCountLabel(value) {
		const labels = {
			'1': '1 –∫–ª–∏–µ–Ω—Ç',
			'2': '2+ –∫–ª–∏–µ–Ω—Ç–æ–≤',
			'5': '5+ –∫–ª–∏–µ–Ω—Ç–æ–≤',
			'10': '10+ –∫–ª–∏–µ–Ω—Ç–æ–≤'
		};
		return labels[value] || value;
	}
	// –£–¥–∞–ª–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ñ–∏–ª—å—Ç—Ä
	function removeFilter(filterKey, valueToRemove = null) {
		if (filterKey === 'ticketCount') {
			$('#filterTicketCount').val('').trigger('change'); // –ò—Å–ø–æ–ª—å–∑—É–µ–º trigger –¥–ª—è Select2
			$('#customTicketFilter').hide();
			$('#customTicketValue').val('');
			customFilter.value = null;
		} else if (valueToRemove !== null) {
			// –î–ª—è –º—É–ª—å—Ç–∏—Å–µ–ª–µ–∫—Ç–æ–≤ —É–¥–∞–ª—è–µ–º –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
			const selectId = `#filter${filterKey.charAt(0).toUpperCase() + filterKey.slice(1)}`;
			const select = $(selectId);
			const currentValues = select.val() || [];
			const newValues = currentValues.filter(v => v !== valueToRemove);
			select.val(newValues).trigger('change'); // –ò—Å–ø–æ–ª—å–∑—É–µ–º trigger –¥–ª—è Select2
		}
		applyFilters();
	}
    // –°–±—Ä–æ—Å –≤—Å–µ—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤
    function resetFilters() {
		// –°–±—Ä–æ—Å —Ñ–∏–ª—å—Ç—Ä–æ–≤ –ø–æ –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –¥–∞–Ω–Ω—ã–º
		$('.filter-select').val(null).trigger('change'); // –ò—Å–ø–æ–ª—å–∑—É–µ–º trigger –¥–ª—è Select2
		// –°–±—Ä–æ—Å —Ñ–∏–ª—å—Ç—Ä–∞ –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É
		$('#filterTicketCount').val('').trigger('change');
		$('#customTicketFilter').hide();
		$('#customTicketValue').val('');
		customFilter.value = null;
		// –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—Å–µ –¥–∞–Ω–Ω—ã–µ
		filteredClients = Array.from(originalClients);
		// –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º –∏—Ç–æ–≥–æ–≤–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞—è–≤–æ–∫
		calculateTotalTickets();
		applyPagination();
		updateClientsCounter(filteredClients.length);
		// –û—á–∏—â–∞–µ–º –±–µ–π–¥–∂–∏
		document.getElementById('filterBadges').innerHTML = '';
		document.getElementById('activeFiltersBadges').innerHTML = '';
		document.getElementById('activeFilters').style.display = 'none';
		refreshClientsPagination();
	}
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
    function initSorting() {
      document.querySelectorAll('.sortable').forEach(header => {
        header.addEventListener('click', function() {
          const column = this.getAttribute('data-sort');
          const currentOrder = this.getAttribute('data-order') || 'asc';
          const newOrder = currentOrder === 'asc' ? 'desc' : 'asc';
          // –°–±—Ä–æ—Å —Å—Ç—Ä–µ–ª–æ–∫ —É –≤—Å–µ—Ö –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤
          document.querySelectorAll('.sortable').forEach(h => {
            h.innerHTML = h.innerHTML.replace(' ‚Üë', '').replace(' ‚Üì', '').replace(' ‚Üï', ' ‚Üï');
            h.setAttribute('data-order', '');
          });
          // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å—Ç—Ä–µ–ª–∫–∏ –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –∑–∞–≥–æ–ª–æ–≤–∫–∞
          this.setAttribute('data-order', newOrder);
          this.innerHTML = this.innerHTML.replace(' ‚Üï', '') + (newOrder === 'asc' ? ' ‚Üë' : ' ‚Üì');
          // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ —Ç–∞–±–ª–∏—Ü—ã
          sortTable(column, newOrder);
        });
      });
	  refreshClientsPagination();
		}
    // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ —Ç–∞–±–ª–∏—Ü—ã
    function sortTable(column, order) {
		filteredClients.sort((a, b) => {
			let aValue, bValue;
			if (column === 'cnt') {
				aValue = parseInt(a.getAttribute('data-cnt'));
				bValue = parseInt(b.getAttribute('data-cnt'));
			} else {
				// –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ data-–∞—Ç—Ä–∏–±—É—Ç—ã
				const dataKeyMap = {
				  'client': 'data-client',
				  'user_id': 'data-user-id',
				  'business': 'data-business',
				  'location_type': 'data-location-type',
				  'city': 'data-city',
				  'location_name': 'data-location',
				  'category': 'data-category',
				  'status': 'data-status'
				};
				const dataKey = dataKeyMap[column];
				if (dataKey) {
					aValue = a.getAttribute(dataKey) || '';
					bValue = b.getAttribute(dataKey) || '';
				} else {
					// fallback, –µ—Å–ª–∏ –∫–ª—é—á –Ω–µ –Ω–∞–π–¥–µ–Ω
					aValue = '';
					bValue = '';
				}
			}
			// –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—É—Å—Ç—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
			if (aValue === '') aValue = '\uFFFF'; // –°—Ç–∞–≤–∏–º –≤ –∫–æ–Ω–µ—Ü –ø—Ä–∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–µ –ø–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—é
			if (bValue === '') bValue = '\uFFFF';
			if (order === 'asc') {
				return aValue.toString().localeCompare(bValue.toString(), undefined, { numeric: true, sensitivity: 'base' });
			} else {
				return bValue.toString().localeCompare(aValue.toString(), undefined, { numeric: true, sensitivity: 'base' });
			}
		});
		applyPagination();
	}
    // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–µ—Ç–∞–ª–µ–π –∫–ª–∏–µ–Ω—Ç–∞ (–∑–∞–≥–ª—É—à–∫–∞)
	function loadClientDetails(user_id) {
		// –¢–∞–∫ –∫–∞–∫ —ç—Ç–æ –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã –∑–¥–µ—Å—å.
		// –ú–æ–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å —Å–æ–æ–±—â–µ–Ω–∏–µ–º –∏–ª–∏ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–∏—Ç—å.
		const modal = new bootstrap.Modal(document.getElementById('clientDetailsModal'));
		modal.show();
		// –ò–ª–∏ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:
		// window.location.href = `/client/${user_id}`;
	}
  </script>
	  <script>
  // === –ü–ê–ì–ò–ù–ê–¶–ò–Ø –î–õ–Ø –¢–ê–ë–õ–ò–¶–´ –ö–õ–ò–ï–ù–¢–û–í (–∞–≥—Ä–µ–≥–∞—Ç—ã) ===
  let clientsCurrentPage = 1;

  function getClientsRows() {
    // –í—Å–µ —Å—Ç—Ä–æ–∫–∏ —Å –¥–∞–Ω–Ω—ã–º–∏, –±–µ–∑ ¬´–∏—Ç–æ–≥–æ–≤–æ–π¬ª —Å—Ç—Ä–æ–∫–∏
    const all = Array.from(document.querySelectorAll('#clientsTable tbody tr'))
      .filter(tr => !tr.classList.contains('ticket-count-total') && tr.style.display !== 'none');
    return all;
  }

  function getPageSize() {
    const sel = document.getElementById('pageSizeSelect');
    const v = sel ? parseInt(sel.value, 10) : 50;
    return isNaN(v) ? 50 : v;
  }

  function renderClientsPagination(totalRows, pageSize) {
    const totalPages = Math.max(1, Math.ceil(totalRows / pageSize));
    const ul = document.getElementById('clientsPagination');
    if (!ul) return;

    // –µ—Å–ª–∏ —Ç–µ–∫—É—â–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –±–æ–ª—å—à–µ –Ω–æ–≤–æ–≥–æ –º–∞–∫—Å–∏–º—É–º–∞ ‚Äî –ø–æ–ø—Ä–∞–≤–∏–º
    if (clientsCurrentPage > totalPages) clientsCurrentPage = totalPages;

    const makePageItem = (label, page, disabled = false, active = false) => {
      const li = document.createElement('li');
      li.className = `page-item ${disabled ? 'disabled' : ''} ${active ? 'active' : ''}`;
      const a = document.createElement('a');
      a.className = 'page-link';
      a.href = '#';
      a.textContent = label;
      if (!disabled) {
        a.addEventListener('click', (e) => {
          e.preventDefault();
          showClientsPage(page);
        });
      }
      li.appendChild(a);
      return li;
    };

    ul.innerHTML = '';

    // ¬´–ù–∞–∑–∞–¥¬ª
    ul.appendChild(makePageItem('¬´', Math.max(1, clientsCurrentPage - 1), clientsCurrentPage === 1));

    // –ù–µ–±–æ–ª—å—à–æ–µ –æ–∫–Ω–æ —Å—Ç—Ä–∞–Ω–∏—Ü –≤–æ–∫—Ä—É–≥ —Ç–µ–∫—É—â–µ–π
    const total = totalPages;
    const windowSize = 5;
    let start = Math.max(1, clientsCurrentPage - 2);
    let end   = Math.min(total, start + windowSize - 1);
    if (end - start + 1 < windowSize) start = Math.max(1, end - windowSize + 1);

    if (start > 1) {
      ul.appendChild(makePageItem('1', 1, false, clientsCurrentPage === 1));
      if (start > 2) {
        const li = document.createElement('li');
        li.className = 'page-item disabled';
        li.innerHTML = '<span class="page-link">‚Ä¶</span>';
        ul.appendChild(li);
      }
    }

    for (let p = start; p <= end; p++) {
      ul.appendChild(makePageItem(String(p), p, false, clientsCurrentPage === p));
    }

    if (end < total) {
      if (end < total - 1) {
        const li = document.createElement('li');
        li.className = 'page-item disabled';
        li.innerHTML = '<span class="page-link">‚Ä¶</span>';
        ul.appendChild(li);
      }
      ul.appendChild(makePageItem(String(total), total, false, clientsCurrentPage === total));
    }

    // ¬´–í–ø–µ—Ä—ë–¥¬ª
    ul.appendChild(makePageItem('¬ª', Math.min(totalPages, clientsCurrentPage + 1), clientsCurrentPage === totalPages));
  }

  function showClientsPage(page = 1) {
    const rows = getClientsRows();
    const pageSize = getPageSize();
    const total = rows.length;
    const totalPages = Math.max(1, Math.ceil(total / pageSize));

    clientsCurrentPage = Math.min(Math.max(1, page), totalPages);

    // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —Å—Ç—Ä–æ–∫–∏, –∑–∞—Ç–µ–º –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–∏–∞–ø–∞–∑–æ–Ω —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    rows.forEach(tr => tr.classList.add('d-none'));
    const startIdx = (clientsCurrentPage - 1) * pageSize;
    const endIdx   = Math.min(startIdx + pageSize, total);
    for (let i = startIdx; i < endIdx; i++) {
      rows[i].classList.remove('d-none');
    }

    // –û–±–Ω–æ–≤–ª—è–µ–º ¬´–ü–æ–∫–∞–∑–∞–Ω–æ: X –∏–∑ Y¬ª
    const visible = endIdx - startIdx;
    const visibleEl = document.getElementById('visibleClientsCount');
    const totalEl   = document.getElementById('totalClientsCount');
    if (visibleEl) visibleEl.textContent = String(visible);
    if (totalEl)   totalEl.textContent   = String(total);

    renderClientsPagination(total, pageSize);
  }

  function refreshClientsPagination() {
    // –≤—ã–∑—ã–≤–∞—Ç—å –ø–æ—Å–ª–µ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏/—Ñ–∏–ª—å—Ç—Ä–∞
    clientsCurrentPage = 1;
    showClientsPage(1);
  }

  // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ ¬´–∑–∞–ø–∏—Å–µ–π –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ¬ª
  const pageSizeSelect = document.getElementById('pageSizeSelect');
  if (pageSizeSelect) {
    pageSizeSelect.addEventListener('change', () => refreshClientsPagination());
  }

  // –•—É–∫–Ω–∏—Å—å –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ñ–∏–ª—å—Ç—Ä—ã/—Å–æ—Ä—Ç–∏—Ä–æ–≤–∫—É:
  // 1) –µ—Å–ª–∏ —É —Ç–µ–±—è –µ—Å—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏ applyFilters()/resetFilters() ‚Äî –¥–æ–±–∞–≤—å –≤ –ö–û–ù–ï–¶ –∫–∞–∂–¥–æ–π:
  //    refreshClientsPagination();
  // 2) –¥–ª—è —Å–æ—Ä—Ç–∏—Ä—É–µ–º—ã—Ö –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ .sortable ‚Äî –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ—Ä—è–¥–∫–∞ —Å—Ç—Ä–æ–∫ —Ç–æ–∂–µ –¥–µ—Ä–Ω–∏ refreshClientsPagination().

  // –ü–µ—Ä–≤–∏—á–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
  document.addEventListener('DOMContentLoaded', () => {
    refreshClientsPagination();
  });
  document.addEventListener('DOMContentLoaded', () => {
  const tc = document.querySelector('.table-container');
  if (tc) {
    tc.addEventListener('wheel', (e) => {
      const atTop = tc.scrollTop === 0;
      const atBottom = Math.ceil(tc.scrollTop + tc.clientHeight) >= tc.scrollHeight;
      const goingUp = e.deltaY < 0;
      const goingDown = e.deltaY > 0;

      // –ï—Å–ª–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —É–ø—ë—Ä—Å—è –≤ –∫—Ä–∞–π ‚Äî –ø—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É
      if ((atTop && goingUp) || (atBottom && goingDown)) {
        e.preventDefault(); // –Ω–µ –∫—Ä—É—Ç–∏–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
        window.scrollBy({ top: e.deltaY, left: 0, behavior: 'auto' }); // –∫—Ä—É—Ç–∏–º —Å—Ç—Ä–∞–Ω–∏—Ü—É
      }
    }, { passive: false });
  }
});

  </script>
</main>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="{{ url_for('static', filename='sidebar.js') }}"></script>
  <script src="{{ url_for('static', filename='modal-transitions.js') }}"></script>
</body>
</html>
